{"version":3,"file":"app.min.js","sources":["app.ts"],"sourcesContent":["/**\n * EGroupware Schulmanager\n *\n * @link http://www.egroupware.org\n * @package schulmanager\n * @author Axel Wild <info-AT-wild-solutions.de>\n * @copyright (c) 2022 by info-AT-wild-solutions.de\n * @license http://opensource.org/licenses/gpl-license.php GPL - GNU General Public License\n */\n\nimport {EgwApp} from '../../api/js/jsapi/egw_app';\n\nimport {etemplate2} from \"../../api/js/etemplate/etemplate2\";\nimport {et2_nextmatch} from \"../../api/js/etemplate/et2_extension_nextmatch\";\nimport {et2_dialog} from \"../../api/js/etemplate/et2_widget_dialog\";\nimport {Et2Select} from \"../../api/js/etemplate/Et2Select/Et2Select\";\nimport {Et2Date} from \"../../api/js/etemplate/Et2Date/Et2Date\";\nimport {SlMenuItem} from \"@shoelace-style/shoelace\";\n\nexport class SchulmanagerApp extends EgwApp\n{\n\treadonly appname = 'schulmanager';\n\n\tconstructor()\n\t{\n\t\tsuper('schulmanager');\n\t}\n\n\t/**\n\t * This function is called when the etemplate2 object is loaded\n\t * and ready.  If you must store a reference to the et2 object,\n\t * make sure to clean it up in destroy().\n\t *\n\t * @param et2 etemplate2 Newly ready object\n\t * @param string name\n\t */\n\tet2_ready(et2, name: string)\n\t{\n\t\t// call parent\n\t\tsuper.et2_ready(et2, name);\n\n\t\tif (name == 'schulmanager.notenmanager.index') {\n            this.header_change();\n\t\t}\n\t\tif (name == 'schulmanager.notenmanager.edit') {\n            //this.header_change();\n        }\n\t\tif (name == 'schulmanager.calendar.index') {\n\t\t\tthis.cal_header_change();\n\t\t\tthis.cal_hide_items();\t\t\t\n        }\n\t\tif (name == 'schulmanager.notenmanager.notendetails') {\n\t\t\tthis.header_change();\n\t\t}\n\t\tif (name == 'schulmanager.schuelerview') {\n\t\t\tthis.onSchuelerViewKlasseChanged();\n\t\t}\n\t}\n\n\n\t/**\n\t * laden der gewichtungen beim ersten Laden des Templates\n\t * @returns {undefined}\n\t */\n\theader_change()\n\t{\n\t\tlet et2 = this.et2;\n\t\tlet func = 'schulmanager.schulmanager_ui.ajax_getGewichtungen';\n\t\tlet query = '';\n\t\tthis.egw.json(func, [query], function (totals) {\n\t\t\tfor (let key in totals){\n\t\t\t\tlet widget = et2.getWidgetById(key);\n\t\t\t\tif(widget){\n\t\t\t\t\twidget.set_value(totals[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t}).sendRequest(true);\n\t}\n\n\t// export notenbuch\n\texportpdf_nb(_id, _widget)\n\t{\n\t\tthis.egw.loading_prompt('schulmanager',true, this.egw.lang('please wait...'));\n\t\tlet $a = jQuery(document.createElement('a')).appendTo('body').hide();\n\t\tlet url = window.egw.webserverUrl+'/index.php?menuaction=schulmanager.schulmanager_download_ui.exportpdf_nb';\n\t\t$a.prop('href',url);\n\t\t$a.prop('download','');\n\t\t$a[0].click();\n\t\t$a.remove();\n\t\tthis.egw.loading_prompt('schulmanager',false);\n\t}\n\n\n\t/**\n\t * download all grades in all subjects of all students as pdf\n\t * @param {type} _id\n\t * @param {type} _widget\n\t * @returns {undefined}\n\t */\n\texportpdf_kv(_id, _widget){\n\t\tlet id = _widget.id;\n\t\tlet params = 'mode=stud';\n\n\t\tif(id == \"button[pdfexportteacherzz]\"){\n\t\t\tparams = 'mode=teacher_zz';\n\t\t}\n\t\telse if(id == \"button[pdfexportteacherjz]\"){\n\t\t\tparams = 'mode=teacher_jz';\n\t\t}\n\n\t\tlet modal = document.getElementById(\"schulmanager-notenmanager-klassenview_showexportmodal\");\n\t\tmodal.style.display = \"none\";\n\n\t\tthis.egw.loading_prompt('schulmanager',true,egw.lang('please wait...'));\n\n\t\tlet $a = jQuery(document.createElement('a')).appendTo('body').hide();\n\t\tlet url = window.egw.webserverUrl+'/index.php?menuaction=schulmanager.schulmanager_download_ui.exportpdf_kv&'+params;\n\t\t$a.prop('href',url);\n\t\t$a.prop('download','');\n\t\t$a[0].click();\n\t\t$a.remove();\n\n\t\tegw.loading_prompt('schulmanager',false);\n\t}\n\n\t/**\n\t * reload klassleiter before pdf export\n\t * @param _id\n\t * @param _widget\n\t */\n\texportpdf_nbericht_prepare(_id, _widget){\n\t\tlet modal = document.getElementById(\"schulmanager-notenmanager-klassenview_showexportmodal\");\n\t\tmodal.style.display = \"block\";\n\n\t\tlet func = 'schulmanager.schulmanager_ui.ajax_nbericht_prepare';\n\n\t\tthis.egw.json(func, [], function (result) {\n\t\t\tlet widget = <HTMLSelectElement> document.getElementById('schulmanager-notenmanager-klassenview_klassleiter');\n\n\t\t\tif(widget){\n\t\t\t\tlet length = widget.options.length;\n\t\t\t\tfor (let i = length-1; i >= 0; i--) {\n\t\t\t\t\twidget.options[i] = null;\n\t\t\t\t}\n\t\t\t\tfor (let key in result['klassleiter']){\n\t\t\t\t\tlet opt = document.createElement(\"option\");\n\t\t\t\t\topt.value = key;\n\t\t\t\t\topt.text = result['klassleiter'][key];\n\t\t\t\t\twidget.options.add(opt);\n\t\t\t\t}\n\t\t\t}\n\t\t}).sendRequest(true);\n\t}\n\n\t/**\n\t * download all grades in all subjects of all students as pdf handout for students\n\t * @param {type} _id\n\t * @param {type} _widget\n\t * @returns {undefined}\n\t */\n\texportpdf_nbericht(_id, _widget){\n\t\tlet modal = document.getElementById(\"schulmanager-notenmanager-klassenview_showexportmodal\");\n\t\tmodal.style.display = \"none\";\n\t\tthis.egw.loading_prompt('schulmanager',true, this.egw.lang('please wait...'));\n\t\tlet showReturn = document.getElementById('schulmanager-notenmanager-klassenview_add_return_block').checked;\n\t\tlet showSigned = document.getElementById('schulmanager-notenmanager-klassenview_add_signed_block').checked;\n\t\tlet signerWidget = <HTMLSelectElement> document.getElementById('schulmanager-notenmanager-klassenview_klassleiter');\n\t\tlet signerid = signerWidget.value;\n\t\tlet $a = jQuery(document.createElement('a')).appendTo('body').hide();\n\t\tlet url = window.egw.webserverUrl+'/index.php?menuaction=schulmanager.schulmanager_download_ui.exportpdf_nbericht&showReturnInfo='+showReturn+'&signed='+showSigned+'&signerid='+signerid;\n\t\t$a.prop('href',url);\n\t\t$a.prop('download','');\n\t\t$a[0].click();\n\t\t$a.remove();\n\t\tthis.egw.loading_prompt('schulmanager',false);\n\t}\n\n\t/**\n\t * export notenbuch\n\t * @param _id\n\t * @param _widget\n\t */\n\texportpdf_calm(_id, _widget)\n\t{\n\t\tlet egw = this.egw;\n        egw.loading_prompt('schulmanager',true,egw.lang('please wait...'));\n\t\tlet $a = jQuery(document.createElement('a')).appendTo('body').hide();\n\t\tlet url = window.egw.webserverUrl+'/index.php?menuaction=schulmanager.schulmanager_download_ui.exportpdf_calm';\n\t\t$a.prop('href',url);\n\t\t$a.prop('download','');\n\t\t$a[0].click();\n\t\t$a.remove();\n\t\tthis.egw.loading_prompt('schulmanager',false);\n\t}\n\n\n\t/**\n\t * laden der weekdays\n\t * @param {type} _action\n\t * @returns {undefined}\n\t */\n\tcal_header_change()\n\t{\n\t\tlet et2 = this.et2;\n\t\tlet func = 'schulmanager.schulmanager_cal_ui.ajax_getWeekdays';\n\n\t\tlet query = '';\n\t\tthis.egw.json(func, [query], function (result) {\n\t\t\tfor (let key in result['nm_header']){\n\t\t\t\tlet widget = et2.getWidgetById(key);\n\t\t\t\tif(widget){\n\t\t\t\t\twidget.getDOMNode().childNodes[0].innerHTML = result['nm_header'][key]['nr'];\n\t\t\t\t\twidget.getDOMNode().childNodes[1].innerHTML = result['nm_header'][key]['name'];\n\t\t\t\t\twidget.parentNode.parentNode.classList.remove('sm_cal_saso');\n\t\t\t\t\twidget.parentNode.parentNode.classList.remove('sm_cal_mofr');\n\t\t\t\t\twidget.parentNode.parentNode.classList.add(result['nm_header'][key]['class']);\n\n\t\t\t\t\tif (result['nm_header'][key]['class'] == 'sm_cal_saso' && widget.getDOMNode().childNodes[2]) {\n                        widget.getDOMNode().childNodes[2].style.display = \"none\";\n                    }\n\t\t\t\t}\n\t\t\t}\n\t\t}).sendRequest(true);\n\t}\n\n\tcal_hide_items()\n\t{\n\t\tegw.css(\".sm_cal_hidden\",\"display:none\");\n\t}\n\n\tcal_focus_item(_action, widget)\n\t{\n\t\t//alert(widget.getDOMNode());\n\t\tlet _send = function() {\n\t\t\tegw().json(\n\t\t\t\t'schulmanager.schulmanager_cal_ui.ajax_editCalEvent',\n\t\t\t\t[\n\t\t\t\t\twidget.id\n\t\t\t\t],\n\t\t\t\t// Remove loading spinner\n\t\t\t\tfunction(result) {\t\t\t\t\t\n\t\t\t\t\tjQuery(_action).blur();\n\t\t\t\t\t//alert(result['test']);\n\t\t\t\t}\n\t\t\t).sendRequest(true);\n\t\t};\n\t\t_send();\n\t}\n\n\tcalEditMultiple(_action, widget)\n\t{\n\t\t//alert(widget.id);\n\t\tlet _send = function() {\n\t\t\tegw().json(\n\t\t\t\t'schulmanager.schulmanager_cal_ui.ajax_editCalEvent',\n\t\t\t\t[\n\t\t\t\t\twidget.id,\n\t\t\t\t\ttrue\n\t\t\t\t],\n\t\t\t\t// Remove loading spinner\n\t\t\t\tfunction(result) {\n\t\t\t\t\tjQuery(_action).blur();\n\t\t\t\t\t//alert(result['test']);\n\t\t\t\t}\n\t\t\t).sendRequest(true);\n\t\t};\n\t\t_send();\n\t}\n\n\tcalDeleteEvent(_action, widget)\n\t{\n\t\t//alert(widget[0].id);\n\t\tlet _send = function() {\n\t\t\tegw().json(\n\t\t\t\t'schulmanager.schulmanager_cal_ui.ajax_deleteEvent',\n\t\t\t\t[\n\t\t\t\t\twidget[0].id\n\t\t\t\t],\n\t\t\t\t// Remove loading spinner\n\t\t\t\tfunction(result) {\n\t\t\t\t\tegw(window).refresh(result['msg'], 'schulmanager', 'schulmanager-calendar-editevent', 'update');\n\t\t\t\t\tvar nm = etemplate2.getById('schulmanager-calendar-editevent').widgetContainer.getWidgetById('nm');\n\t\t\t\t\tnm.refresh(null,'update');\n\t\t\t\t}\n\t\t\t).sendRequest(true);\n\t\t};\n\t\t_send();\n\t}\n\n\tadd_list_event(widget,prefix){\n\t\tlet et2 = this.et2;\n\t\tlet type_id = prefix.concat('sm_type_options_list');\n\t\tlet fach_id = prefix.concat('sm_fach_options_list');\n\t\tlet user_id = prefix.concat('sm_user_list');\n\n\t\tlet type = (<HTMLInputElement> document.getElementById(type_id)).value;\n\t\tlet fach = (<HTMLInputElement> document.getElementById(fach_id)).value;\n\t\tlet user = null;\n\n\t\tif(document.getElementById(user_id)){\n\t\t\tuser = (<HTMLInputElement> document.getElementById(user_id)).value;\n\t\t}\n\t\telse{\n\t\t\tuser_id = prefix.concat('sm_activeuserID');\n\t\t\tuser = (<HTMLInputElement> document.getElementById(user_id)).value;\n\t\t}\n\n\t\tlet _send = function() {\n\t\t\tegw().json(\n\t\t\t\t'schulmanager.schulmanager_cal_ui.ajax_addEventToList',\n\t\t\t\t[\n\t\t\t\t\ttype,\n\t\t\t\t\tfach,\n\t\t\t\t\tuser\n\t\t\t\t],\n\t\t\t\t// Remove loading spinner\n\t\t\t\tfunction(result : any) {\n\t\t\t\t\tegw(window).refresh(result['msg'], 'schulmanager', 'schulmanager-calendar-editevent', 'update');\n\t\t\t\t\tlet nm = etemplate2.getById('schulmanager-calendar-editevent').widgetContainer.getWidgetById('nm');\n\t\t\t\t\tnm.refresh(null,'update');\n\t\t\t\t}\n\t\t\t).sendRequest(true);\n\t\t};\n\t\t_send();\n\n\t}\n\n\tcalShowAddEvent(action, selected){\n\t\tjQuery('table.addnewevent').css('display','inline');\n\t}\n\n\tnmEditGew(_action, widget)\n\t{\n\t\tjQuery('table.editgew').css('display','inline');\n\t}\n\n\n\t/**\n\t *\n\t * @param {egwAction} action\n\t * @param {egwActionObject[]} _senders\n\t */\n\tchangeNote(action, _senders)\n\t{\n\t\tlet tokenDiv = <HTMLInputElement> document.getElementById('schulmanager-notenmanager-edit_token');\n\t\t//let inputinfo_date = <HTMLInputElement> document.getElementById('schulmanager-notenmanager-edit_date').firstChild;\n\t\tlet inputinfo_date = <HTMLInputElement> document.getElementById('schulmanager-notenmanager-edit_inputinfo_date');//.firstChild;\n\t\tlet inputinfo_type = <HTMLInputElement> document.getElementById('schulmanager-notenmanager-edit_inputinfo_notgebart');\n\t\tlet inputinfo_desc = <HTMLInputElement> document.getElementById('schulmanager-notenmanager-edit_inputinfo_desc');\n\n\t\tlet func = 'schulmanager.schulmanager_ui.ajax_noteModified';\n\t\tlet noteKey = action.name;\n\t\tlet noteVal = action.value;\n\t\tlet token = tokenDiv.value;\n\n\t\tlet note_date = inputinfo_date.value;\n\t\tlet note_type = inputinfo_type.value;\n\t\tlet note_desc = inputinfo_desc.value;\n\n\t\tif(_senders.nodeName == \"ET2-CHECKBOX\"){\n\t\t\tnoteKey = _senders._widget_id;\n\t\t\tif(_senders.checked){\n\t\t\t\tnoteVal = 1;\n\t\t\t}else{\n\t\t\t\tnoteVal = 0;\n\t\t\t}\n\t\t}\n\t\tthis.egw.json(func, [noteKey, noteVal, token, note_date, note_type, note_desc], function (result) {\n\t\t\tjQuery(action).addClass('schulmanager_note_changed');\n\t\t\tfor (let key in result){\n\t\t\t\tif(key == 'error_msg'){\n\t\t\t\t\talert(\"Error:\\n\\t\"+result[key]);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tlet cssAvgKey = 'schulmanager-notenmanager-edit_'+key+'[-1][note]';\n\t\t\t\tlet widget = <HTMLInputElement> document.getElementById(cssAvgKey);\n\t\t\t\tif(widget){\n\t\t\t\t\twidget.value = result[key]['[-1][note]'];\n\t\t\t\t\tif(action.id == cssAvgKey){\n\t\t\t\t\t\t// reset css class if this input value has been modified\n\t\t\t\t\t\tjQuery(action).removeClass('nm_avg_manuell');\n\t\t\t\t\t\tjQuery(action).removeClass('nm_avg_auto');\n\t\t\t\t\t\tjQuery(action).addClass(result[key]['avgclass']);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}).sendRequest(true);\n\t}\n\n\n\t\n    changeGew(action, senders)\n\t{\n\t\tlet et2 = this.et2;\n\t\tlet func = 'schulmanager.schulmanager_ui.ajax_gewModified';\n\t\tlet gewKey = action.name;\n\t\tlet gewVal = action.value;\n\n\t\tthis.egw.json(func, [gewKey, gewVal], function (result) {\n\t\t\tjQuery(action).addClass('schulmanager_note_changed');\n\t\t\tfor (let key in result){\n\t\t\t\tlet cssAvgKey = 'schulmanager-notenmanager-edit_'+key+'[-1][note]';\n\t\t\t\tlet widget = <HTMLInputElement> document.getElementById(cssAvgKey);\n\t\t\t\tif(widget){\n\t\t\t\t\twidget.value = result[key]['[-1][note]'];\n\t\t\t\t}\n\t\t\t}\n\t\t}).sendRequest(true);\n\t}\n\n\tchangeGewAllModified(_action, _senders)\n\t{\n\n\t\tlet et2 = this.et2;\n\t\tlet func = 'schulmanager.schulmanager_ui.ajax_gewAllModified';\n\t\t//let noteKey = _action.name;\n\t\tlet noteKey = _senders._widget_id;\n\t\tlet noteVal = _action.value;\n\t\t//if(_action.type == \"checkbox\"){\n\t\tif(_senders.nodeName == \"ET2-CHECKBOX\"){\n\t\t\tif(_senders.checked){\n\t\t\t\tnoteVal = 1;\n\t\t\t}else{\n\t\t\t\tnoteVal = 0;\n\t\t\t}\n\t\t}\n\t\tthis.egw.json(func, [noteKey, noteVal], function (result) {\n\t\t\tjQuery(_action).addClass('schulmanager_note_changed');\n\t\t\tfor (let key in result){\n\t\t\t\tlet cssAvgKey = 'schulmanager-notenmanager-edit_'+key+'[-1][note]';\n\t\t\t\tlet cssAltBKey = 'schulmanager-notenmanager-edit_nm_rows_'+key+'[-1][checked]';\n\t\t\t\tlet widget = <HTMLInputElement> document.getElementById(cssAvgKey);\n\t\t\t\tlet widgetAltB = <HTMLInputElement> document.getElementById(cssAltBKey);\n\t\t\t\tif(widget){\n\t\t\t\t\twidget.value = result[key]['[-1][note]'];\n\t\t\t\t\tif(_action.id == cssAvgKey){\n\t\t\t\t\t\tjQuery(_action).removeClass('nm_avg_manuell');\n\t\t\t\t\t\tjQuery(_action).removeClass('nm_avg_auto');\n\t\t\t\t\t\tjQuery(_action).addClass(result[key]['avgclass']);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if(widgetAltB){\n\t\t\t\t\twidgetAltB.checked = result[key]['[-1][checked]'];\n\t\t\t\t}\n\t\t\t}\n\t\t}).sendRequest(true);\n\t}\n\t\n\t/**\n\t * selectes teacher for a new substitution changed, reload list\n\t */\n\tsubs_TeacherChanged(_action, _senders)\n\t{\n\t\tlet et2 = this.et2;\n\t\tlet func = 'schulmanager.schulmanager_substitution_ui.ajax_getTeacherLessonList';\n\t\tlet teacher_id = _senders.value;\n\t\t\n\t\tthis.egw.json(func, [teacher_id], function (result) {\n\t\t\tlet widget = <Et2Select> document.getElementById('schulmanager-substitution_add_lesson_list');\n\t\t\t\t\t\n\t\t\tif(widget){\n\t\t\t\twhile (widget.firstChild) {\n\t\t\t\t\twidget.removeChild(widget.firstChild);\n\t\t\t\t}\n\t\t\t\tfor (let key in result){\n\t\t\t\t\tlet item = new SlMenuItem();\n\t\t\t\t\titem.value = key;\n\t\t\t\t\titem.innerText = result[key];\n\t\t\t\t\twidget.appendChild(item);\n\t\t\t\t}\n\t\t\t}\n\t\t}).sendRequest(true);\n\t}\n\n\t/**\n\t * AJAX loading student\n\t * @param _action\n\t * @param _senders\n\t */\n\tonDetailsNote(_action, _senders)\n\t{\n\n\t\tlet modal = document.getElementById(\"schulmanager-notenmanager-index_showdetailsmodal\");\n\t\tmodal.style.display = \"block\";\n\n\t\tlet instance = this;\n\t\tlet stud_id = _senders[0]._index;\n\t\tlet func = 'schulmanager.schulmanager_ui.ajax_getStudentDetails';\n\n\t\tthis.egw.json(func, [stud_id], function (result) {\n\t\t\tlet modal = document.getElementById(\"schulmanager-notenmanager-index\");\n\t\t\tmodal.style.display = \"block\";\n\n\t\t\tfor (let key in result){\n\t\t\t\t// noten\n\t\t\t\tif(key == 'details_noten'){\n\t\t\t\t\tinstance.updateDetailsNoten(key, result, 'schulmanager-notenmanager-index_showdetailsmodal_showdetailscontent_details_noten');\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tlet widget_id = 'schulmanager-notenmanager-index_showdetailsmodal_showdetailscontent' + key;\n\t\t\t\t\tlet widget = <HTMLInputElement>document.getElementById(widget_id);\n\t\t\t\t\tif (widget) {\n\t\t\t\t\t\twidget.innerText = result[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tjQuery('#schulmanager-notenmanager-index_schulmanager-notenmanager-details').css('display','inline');\n\t\t}).sendRequest(true);\n\t}\n\n\t/**\n\t * AJAX loading student\n\t * @param _action\n\t * @param _senders\n\t */\n\tonContactData(_action, _senders)\n\t{\n\t\tlet modal = document.getElementById(\"schulmanager-notenmanager-index_showcontactmodal\");\n\t\tmodal.style.display = \"block\";\n\n\t\tlet instance = this;\n\t\tlet stud_id = _senders[0]._index;\n\t\tlet func = 'schulmanager.schulmanager_ui.ajax_getStudentContact';\n\n\t\tthis.egw.json(func, [stud_id], function (result) {\n\t\t\tlet modal = document.getElementById(\"schulmanager-notenmanager-index\");\n\t\t\tmodal.style.display = \"block\";\n\n\t\t\tinstance.tableUpdate(\"schulmanager-notenmanager-index_grid-sko\", result['sko_nm_rows']);\n\t\t\tinstance.tableUpdate(\"schulmanager-notenmanager-index_grid-san\", result['san_nm_rows']);\n\t\t\tdelete result['sko_nm_rows'];\n\t\t\tdelete result['san_nm_rows'];\n\n\t\t\tfor (let key in result){\n\t\t\t\tlet widget_id = 'schulmanager-notenmanager-index_' + key;\n\t\t\t\tlet widget = <HTMLInputElement>document.getElementById(widget_id);\n\t\t\t\tif (widget) {\n\t\t\t\t\twidget.innerText = result[key];\n\t\t\t\t}\n\t\t\t}\n\t\t\tjQuery('#schulmanager-notenmanager-index_schulmanager-contact').css('display','inline');\n\t\t}).sendRequest(true);\n\t}\n\n\n\n\n\t/**\n\t * select students for a new class changed, reload list\n\t */\n\tonDetailsKlasseChanged(_action, _senders)\n\t{\n\t\tlet instance = this;\n\t\tlet egw = this.egw;\n\t\tthis.egw.loading_prompt('schulmanager',true,egw.lang('please wait...'));\n\t\tlet et2 = this.et2;\n\t\tlet func = 'schulmanager.schulmanager_ui.ajax_DetailsKlasseChanged';\n\t\tlet klasse_id = _senders.value;\n\n\t\tthis.egw.json(func, [klasse_id], function (result) {\n\t\t\t// update schueler select\n\t\t\tlet widget = <Et2Select> document.getElementById('schulmanager-notenmanager-notendetails_select_schueler');\n\n\t\t\tif(widget){\n\t\t\t\twhile (widget.firstChild) {\n\t\t\t\t\twidget.removeChild(widget.firstChild);\n\t\t\t\t}\n\t\t\t\tfor (let key in result['select_schueler']){\n\t\t\t\t\tlet item = new SlMenuItem();\n\t\t\t\t\titem.value = key;\n\t\t\t\t\titem.innerText =result['select_schueler'][key];\n\t\t\t\t\twidget.appendChild(item);\n\t\t\t\t}\n\t\t\t}\n\t\t\tdelete(result['select_schueler']);\n\n\t\t\tfor (let key in result){\n\t\t\t\tif(key == 'details_noten'){\n\t\t\t\t\tinstance.updateDetailsNoten(key, result, 'schulmanager-notenmanager-notendetails_details_noten');\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tlet widgetItem = document.getElementById('schulmanager-notenmanager-notendetails_' + key);\n\t\t\t\t\tif (widgetItem) {\n\t\t\t\t\t\twidgetItem.innerText = result[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tegw.loading_prompt('schulmanager',false);\n\t\t}).sendRequest(true);\n\t}\n\n\t/**\n\t * selectes teacher for a new substitution changed, reload list\n\t */\n\tonDetailsSchuelerChanged(_action, _senders)\n\t{\n\t\tlet instance = this;\n\t\t//this.egw.loading_prompt('schulmanager',true,egw.lang('please wait...'));\n\t\tlet et2 = this.et2;\n\t\tlet func = 'schulmanager.schulmanager_ui.ajax_DetailsSchuelerChanged';\n\t\tlet schueler_id = _senders.value;\n\n\t\tthis.egw.json(func, [schueler_id], function (result) {\n\t\t\tfor (let key in result){\n\t\t\t\tif(key == 'details_noten'){\n\t\t\t\t\tinstance.updateDetailsNoten(key, result, 'schulmanager-notenmanager-notendetails_details_noten');\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tlet widgetItem = document.getElementById('schulmanager-notenmanager-notendetails_' + key);\n\t\t\t\t\tif (widgetItem) {\n\t\t\t\t\t\twidgetItem.innerText = result[key];\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//alert(key);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t//egw.loading_prompt('schulmanager',false);\n\t\t}).sendRequest(true);\n\t}\n\n\t/**\n\t * updates noten table in details view\n\t * @param key\n\t * @param result\n\t */\n\tupdateDetailsNoten(key, result, id_prefix)\n\t{\n\t\tif(key == 'details_noten'){\n\t\t\tfor (let block in result[key]){\n\t\t\t\tfor(let sIndex in result[key][block]){\n\t\t\t\t\tlet index = parseInt(sIndex);\n\t\t\t\t\tif(index >= -1 && index <= 11){\n\t\t\t\t\t\tfor(let col in result[key][block][index]){\n\t\t\t\t\t\t\tlet widget_col_id = id_prefix+'['+block+']'+'['+index+']'+'['+col+']';\n\t\t\t\t\t\t\tlet widget_col = document.getElementById(widget_col_id);\n\t\t\t\t\t\t\tif(widget_col){\n\t\t\t\t\t\t\t\twidget_col.innerText = result[key][block][index][col];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\n\t/**\n\t * selectes teacher for a new substitution changed, reload list\n\t */\n\tonDetailsNotenEdit(_action, _senders)\n\t{\n\t\tlet idPostfix = _senders.id.substring(4)\n\t\tlet isGlnw = _senders.id.substring(5, 9) == 'glnw';\n\t\tlet modal = document.getElementById(\"schulmanager-notenmanager-notendetails_editcontentmodal\");\n\t\tmodal.style.display = \"block\";\n\n\t\tlet widgetNote = <HTMLLabelElement>document.getElementById('schulmanager-notenmanager-notendetails_details_noten' + idPostfix + '[note]');\n\t\tif(widgetNote) {\n\t\t\tlet note_input = <HTMLInputElement>document.getElementById('schulmanager-notenmanager-notendetails_editcontentmodal_editcontent_edit_note');\n\t\t\tnote_input.value = widgetNote.innerText;\n\t\t}\n\n\t\t// select GLNW and KLNW\n\t\tlet widgetTypeGKlnw = <HTMLLabelElement>document.getElementById('schulmanager-notenmanager-notendetails_details_noten' + idPostfix + '[art]');\n\t\tif(widgetTypeGKlnw){\n\t\t\tlet selTypeGlnw = <Et2Select>document.getElementById('schulmanager-notenmanager-notendetails_editcontentmodal_editcontent_notgebart_glnw');\n\t\t\tlet selTypeKlnw = <Et2Select>document.getElementById('schulmanager-notenmanager-notendetails_editcontentmodal_editcontent_notgebart_klnw');\n\n\t\t\tif(isGlnw) {\n\t\t\t\tfor (let i = 0; i < selTypeGlnw.menuItems.length; i++) {\n\t\t\t\t\tif (selTypeGlnw.menuItems[i].innerText.trim() == widgetTypeGKlnw.value) {\n\t\t\t\t\t\tselTypeGlnw.set_value(i);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tselTypeGlnw.style.display = \"block\";\n\t\t\t\tselTypeKlnw.set_value(0);\n\t\t\t\tselTypeKlnw.style.display = \"none\";\n\n\t\t\t\t// update style\n\t\t\t\tjQuery(\".details-grid-edit tr:nth-child(even)\").css(\"background\", \"#fff9ba\");\n\t\t\t\tjQuery(\".details-grid-edit tr:nth-child(odd)\").css(\"background\", \"#fff47c\");\n\t\t\t\tjQuery(\".details-grid-edit td\").css(\"border\", \"1px solid #ffdd00\");\n\t\t\t\t// end update style\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfor (let i = 0; i < selTypeKlnw.menuItems.length; i++) {\n\t\t\t\t\tif(selTypeKlnw.menuItems[i].innerText.trim() == widgetTypeGKlnw.value){\n\t\t\t\t\t\tselTypeKlnw.set_value(i);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tselTypeGlnw.set_value(0);\n\t\t\t\tselTypeGlnw.style.display = \"none\";\n\t\t\t\tselTypeKlnw.style.display = \"block\";\n\n\t\t\t\t// update style\n\t\t\t\tjQuery(\".details-grid-edit tr:nth-child(even)\").css(\"background\", \"#beeaac\");\n\t\t\t\tjQuery(\".details-grid-edit tr:nth-child(odd)\").css(\"background\", \"#a1e684\");\n\t\t\t\tjQuery(\".details-grid-edit td\").css(\"border\", \"1px solid #7ecc67\");\n\t\t\t\t// end update style\n\t\t\t}\n\t\t\tdocument.getElementById('schulmanager-notenmanager-notendetails_edit_type_flag').innerText = isGlnw ? \"glnw\" : \"klnw\";\n\t\t}\n\t\t// definition date\n\t\tlet widgetDefDate = <HTMLLabelElement>document.getElementById('schulmanager-notenmanager-notendetails_details_noten' + idPostfix + '[definition_date]');\n\t\tif(widgetDefDate){\n\t\t\tlet defDate_input = <HTMLInputElement> document.getElementById('schulmanager-notenmanager-notendetails_editcontentmodal_editcontent_edit_date');\n\t\t\tdefDate_input.value = widgetDefDate.innerText;\n\t\t}\n\t\t// description\n\t\tlet widgetDesc = <HTMLLabelElement>document.getElementById('schulmanager-notenmanager-notendetails_details_noten' + idPostfix + '[description]');\n\t\tif(widgetDesc){\n\t\t\tlet desc_input = <HTMLInputElement> document.getElementById('schulmanager-notenmanager-notendetails_editcontentmodal_editcontent_edit_desc');\n\t\t\tdesc_input.value = widgetDesc.innerText;\n\t\t}\n\n\t\t// note kaay\n\t\tlet note_key = <HTMLInputElement>document.getElementById('schulmanager-notenmanager-notendetails_edit_note_key');\n\t\tnote_key.value = idPostfix;\n\t}\n\n\t/**\n\t * Commits edited noten value\n\t * @param _action\n\t * @param _senders\n\t */\n\tonDetailsNotenCommit(_action, _senders)\n\t{\n\t\tlet egw = this.egw;\n\t\tlet instance = this;\n\t\tthis.egw.loading_prompt('schulmanager',true,egw.lang('please wait...'));\n\t\t// read data\n\t\tlet noteElement = <HTMLInputElement>document.getElementById('schulmanager-notenmanager-notendetails_editcontentmodal_editcontent_edit_note');\n\t\tlet noteVal = noteElement.value;\n\n\t\tlet typeFlagElement = document.getElementById('schulmanager-notenmanager-notendetails_edit_type_flag');\n\t\tlet typeFlag = typeFlagElement.innerText;\n\n\t\tlet note_type = \"0\";\n\n\t\tif(typeFlag == \"glnw\"){\n\t\t\tlet selTypeGlnw = <Et2Select>document.getElementById('schulmanager-notenmanager-notendetails_editcontentmodal_editcontent_notgebart_glnw');\n\t\t\tnote_type = selTypeGlnw.value;\n\n\t\t}\n\t\telse if(typeFlag == \"klnw\"){\n\t\t\tlet selTypeKlnw = <Et2Select>document.getElementById('schulmanager-notenmanager-notendetails_editcontentmodal_editcontent_notgebart_klnw');\n\t\t\tnote_type = selTypeKlnw.value;\n\t\t}\n\n\t\tlet dateElement = <Et2Date> document.getElementById('schulmanager-notenmanager-notendetails_editcontentmodal_editcontent_edit_date');\n\t\tlet note_date = dateElement.value;\n\n\t\tlet descElement = <HTMLInputElement> document.getElementById('schulmanager-notenmanager-notendetails_editcontentmodal_editcontent_edit_desc');\n\t\tlet note_desc = descElement.value;\n\n\t\tlet tokenElement = <HTMLInputElement> document.getElementById('schulmanager-notenmanager-notendetails_token');\n\t\tlet token = tokenElement.value;\n\n\t\tlet noteKeyElement = <HTMLInputElement> document.getElementById('schulmanager-notenmanager-notendetails_edit_note_key');\n\t\tlet noteKey = noteKeyElement.value\n\n\t\t// send data\n\t\tlet func = 'schulmanager.schulmanager_ui.ajax_noteDetailsModified';\n\n\t\tthis.egw.json(func, [noteKey, noteVal, token, note_date, note_type, note_desc, typeFlag], function (result) {\n\t\t\t//alert(\"done\");\n\t\t\tfor (let key in result){\n\t\t\t\tif(key == 'details_noten'){\n\t\t\t\t\tinstance.updateDetailsNoten(key, result, 'schulmanager-notenmanager-notendetails_details_noten');\n\t\t\t\t}\n\t\t\t\telse {\n\n\t\t\t\t\tlet widgetItem = document.getElementById('schulmanager-notenmanager-notendetails_' + key);\n\t\t\t\t\tif (widgetItem) {\n\t\t\t\t\t\twidgetItem.innerText = result[key];\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//alert(key);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tegw.loading_prompt('schulmanager',false);\n\t\t}).sendRequest(true);\n\n\t\t// hide div\n\t\tlet modal = document.getElementById(\"schulmanager-notenmanager-notendetails_editcontentmodal\");\n\t\tmodal.style.display = \"none\";\n\t}\n\n\tonDetailsNotenCancel(_action, _senders)\n\t{\n\t\tlet modal = document.getElementById(\"schulmanager-notenmanager-notendetails_editcontentmodal\");\n\t\tmodal.style.display = \"none\";\n\t}\n\n\t/**\n\t * Delete single\n\t * @param _action\n\t * @param _senders\n\t */\n\tonDetailsNotenDelete(_action, _senders)\n\t{\n\t\tlet instance = this;\n\t\tlet egw = this.egw;\n\n\t\tlet tokenElement = <HTMLInputElement> document.getElementById('schulmanager-notenmanager-notendetails_token');\n\t\tlet token = tokenElement.value;\n\n\t\tlet noteKeyElement = <HTMLInputElement> document.getElementById('schulmanager-notenmanager-notendetails_edit_note_key');\n\t\tlet noteKey = noteKeyElement.value\n\t\t//var modal = document.getElementById(\"schulmanager-notenmanager-notendetails_editcontentmodal\");\n\t\t//modal.style.display = \"none\";\n\n\t\tlet action_id = _action.id;\n\t\tet2_dialog.show_dialog(function(button_id,value)\n\t\t{\n\t\t\tif (button_id != et2_dialog.NO_BUTTON)\n\t\t\t{\n\t\t\t\tlet func = 'schulmanager.schulmanager_ui.ajax_noteDetailsDeleted';\n\n\t\t\t\tegw.json(func, [noteKey, token], function (result) {\n\t\t\t\t\tfor (let key in result){\n\t\t\t\t\t\tif(key == 'details_noten'){\n\t\t\t\t\t\t\tinstance.updateDetailsNoten(key, result, 'schulmanager-notenmanager-notendetails_details_noten');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tlet widgetItem = document.getElementById('schulmanager-notenmanager-notendetails_' + key);\n\t\t\t\t\t\t\tif (widgetItem) {\n\t\t\t\t\t\t\t\twidgetItem.innerText = result[key];\n\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t}).sendRequest(true);\n\t\t\t}\n\n\t\t}, egw.lang('Confirmation required'), egw.lang('Confirmation required'), {}, et2_dialog.BUTTONS_OK_CANCEL, et2_dialog.QUESTION_MESSAGE);\n\n\t\tlet modal = document.getElementById(\"schulmanager-notenmanager-notendetails_editcontentmodal\");\n\t\tmodal.style.display = \"none\";\n\t}\n\n\t/**\n\t * select students for a new class changed, reload list\n\t * @param _action\n\t * @param _senders\n\t */\n\tonSchuelerViewKlasseChanged(_action, _senders)\n\t{\n\t\tlet instance = this;\n\t\t//let et2 = this.et2;\n\t\tlet func = 'schulmanager.schulmanager_ui.ajax_schuelerViewKlasseChanged';\n\t\tlet klasse_id = 0;\n\n\t\tif(_action !== null){\n\t\t\tklasse_id = _senders.value;\n\t\t}\n\n\t\tthis.egw.json(func, [klasse_id], function (result) {\n\t\t\t/*\n\t\t\tvar sla_nm = <et2_nextmatch>et2.getWidgetById('sla_nm');\n\t\t\tvar sko_nm = <et2_nextmatch>et2.getWidgetById('sko_nm');\n\t\t\tsla_nm.applyFilters();\n\t\t\tsko_nm.applyFilters();\n\t\t\t*/\n\t\t\tlet not_nm = <et2_nextmatch>et2.getWidgetById('not_nm');\n\t\t\tnot_nm.applyFilters();\n\n\t\t\t// ############### new version\n\t\t\t//instance.tableUpdate(\"schulmanager-schuelerview_grid-sla\", result['sla_nm_rows']);\n\t\t\t//instance.tableUpdate(\"schulmanager-schuelerview_grid-sko\", result['sko_nm_rows']);\n\t\t\t//instance.tableUpdate(\"schulmanager-schuelerview_grid-san\", result['san_nm_rows']);\n\t\t\t// ##############################\n\n\t\t\t// update schueler select\n\t\t\tlet widget = <HTMLSelectElement> document.getElementById('schulmanager-schuelerview_select_schueler');\n\t\t\tif(widget){\n\t\t\t\twhile (widget.firstChild) {\n\t\t\t\t\twidget.removeChild(widget.firstChild);\n\t\t\t\t}\n\t\t\t\tfor (let key in result['select_schueler']){\n\t\t\t\t\tlet item = new SlMenuItem();\n\t\t\t\t\titem.value = key;\n\t\t\t\t\titem.innerText = result['select_schueler'][key];\n\t\t\t\t\twidget.appendChild(item);\n\t\t\t\t}\n\t\t\t}\n\t\t\tdelete(result['select_schueler']);\n\n\t\t\tinstance.schuelerViewUpdate(instance, result);\n\n\t\t\t/*for (var key in result){\n\t\t\t\tif(key == 'details_noten'){\n\t\t\t\t}\n\t\t\t\telse {\n\n\t\t\t\t\tvar widgetItem = document.getElementById('schulmanager-schuelerview_' + key);\n\t\t\t\t\tif (widgetItem) {\n\t\t\t\t\t\twidgetItem.innerText = result[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}*/\n\n\t\t\t//egw.loading_prompt('schulmanager',false);\n\t\t}).sendRequest(true);\n\t}\n\n\t/**\n\t * select students for a new class changed, reload list\n\t */\n\tonSchuelerViewSchuelerChanged(_action, _senders) {\n\t\tlet instance = this;\n\t\t//var egw = this.egw;\n\t\t//this.egw.loading_prompt('schulmanager',true,egw.lang('please wait...'));\n\n\n\t\tlet et2 = this.et2;\n\t\tlet func = 'schulmanager.schulmanager_ui.ajax_schuelerViewSchuelerChanged';\n\t\tlet schueler_id = _senders.value;\n\n\t\tthis.egw.json(func, [schueler_id], function (result) {\n\t\t\t/*\n\t\t\tvar sla_nm = <et2_nextmatch>et2.getWidgetById('sla_nm');\n\t\t\tvar sko_nm = <et2_nextmatch>et2.getWidgetById('sko_nm');\n\t\t\tsla_nm.applyFilters('');\n\t\t\tsko_nm.applyFilters('');\n\t\t\t*/\n\t\t\tlet not_nm = <et2_nextmatch>et2.getWidgetById('not_nm');\n\t\t\tnot_nm.applyFilters();\n\n\t\t\tinstance.schuelerViewUpdate(instance, result);\n\t\t\t//egw.loading_prompt('schulmanager',false);\n\t\t}).sendRequest(true);\n\t}\n\n\t/**\n\t * updates nested content\n\t * @param instance\n\t * @param result\n\t */\n\tschuelerViewUpdate(instance, result){\n\t\t// ############### new version\n\t\tinstance.tableUpdate(\"schulmanager-schuelerview_grid-sla\", result['sla_nm_rows']);\n\t\tinstance.tableUpdate(\"schulmanager-schuelerview_grid-sko\", result['sko_nm_rows']);\n\t\tinstance.tableUpdate(\"schulmanager-schuelerview_grid-san\", result['san_nm_rows']);\n\t\t//instance.tableUpdate(\"schulmanager-schuelerview_grid-noten\", result['noten_nm_rows']);\n\t\t// ##############################\n\n\t\tfor (let key in result){\n\t\t\tif(key != 'sla_nm_rows' && key != 'sko_nm_rows' && key != 'san_nm_rows'){\n\t\t\t\tlet widgetItem = document.getElementById('schulmanager-schuelerview_' + key);\n\t\t\t\tif (widgetItem) {\n\t\t\t\t\twidgetItem.innerText = result[key];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * appends a new row\n\t * @param id\n\t * @param row\n\t */\n\ttableUpdate(id, rows){\n\t\tlet table = <HTMLTableElement>document.getElementById(id);\n\n\t\t// delete rows\n\t\twhile(table.rows.length > 1) {\n\t\t\ttable.deleteRow(1);\n\t\t}\n\n\t\t// add new rows\n\t\tif(table){\n\t\t\tfor (let r = 0; r < rows.length; r++) {\n\t\t\t\tlet newRow = table.insertRow(table.rows.length);\n\t\t\t\tlet rowData = rows[r];\n\t\t\t\tfor (let i = 0; i < rowData.length; i++) {\n\t\t\t\t\tlet cell = newRow.insertCell(i);\n\t\t\t\t\tcell.innerHTML = rowData[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\n\t/**\n\t * Serach accounts to map them to teachers\n\t */\n\tonTeacherAutoLinking(_action, _senders) {\n\t\tlet et2 = this.et2;\n\t\tlet func = 'schulmanager.schulmanager_substitution_ui.ajax_onTeacherAutoLinking';\n\n\t\tthis.egw.json(func, [], function (result) {\n\t\t\tlet nm = <et2_nextmatch>et2.getWidgetById('nm');\n\t\t\tnm.applyFilters();\n\t\t}).sendRequest(true);\n\n\t}\n\n\t/**\n\t * Before linking teacher tom egw account\n\t * @param _action\n\t * @param _senders\n\t */\n\tonTeacherAccountLinkEdit(_action, _senders)\n\t{\n\t\tlet row_id = _senders[0]._index;\n\n\t\tlet func = 'schulmanager.schulmanager_substitution_ui.ajax_onTeacherAccountLinkEdit';\n\n\t\tthis.egw.json(func, [row_id], function (result) {\n\t\t\tlet modal = document.getElementById(\"schulmanager-accounts_editcontentmodal\");\n\t\t\tmodal.style.display = \"block\";\n\n\t\t\tdelete(result['link_account_id']);\n\n\t\t\tfor (let key in result){\n\t\t\t\tlet widget_id = 'schulmanager-accounts_' + key;\n\t\t\t\tlet widget = <HTMLInputElement>document.getElementById(widget_id);\n\t\t\t\tif (widget) {\n\t\t\t\t\twidget.innerText = result[key];\n\t\t\t\t}\n\t\t\t}\n\t\t}).sendRequest(true);\n\t}\n\n\t/**\n\t * Commit teacher-account-link\n\t * @param _action\n\t * @param _senders\n\t */\n\tonTeacherAccountLinkCommit(_action, _senders)\n\t{\n\t\tlet modal = document.getElementById(\"schulmanager-accounts_editcontentmodal\");\n\t\tmodal.style.display = \"none\";\n\n\t\tlet et2 = this.et2;\n\t\tlet selAccount = <HTMLSelectElement>document.getElementById('schulmanager-accounts_account_id');\n\t\tlet account = selAccount.value;\n\t\tlet tokenDiv = <HTMLInputElement> document.getElementById('schulmanager-accounts_token');\n\t\tlet token = tokenDiv.value;\n\n\t\tlet func = 'schulmanager.schulmanager_substitution_ui.ajax_onTeacherAccountLinkCommit';\n\n\t\tthis.egw.json(func, [account, token], function (result) {\n\t\t\tlet nm = <et2_nextmatch>et2.getWidgetById('nm');\n\t\t\tnm.refresh(result['row_index'], et2_nextmatch.UPDATE);\n\t\t}).sendRequest(true);\n\n\t}\n\n\t/**\n\t * Reset single row, delete teacher-account-link\n\t * @param _action\n\t * @param _senders\n\t */\n\tonTeacherAccountLinkReset(_action, _senders)\n\t{\n\t\tlet et2 = this.et2;\n\n\t\tlet row_ids = [];\n\t\tfor (let i = 0; i < _senders.length; i++) {\n\t\t\trow_ids.push(_senders[i]._index);\n\t\t}\n\n\t\t//var row_id = _senders[0]._index;\n\t\tlet tokenDiv = <HTMLInputElement> document.getElementById('schulmanager-accounts_token');\n\t\tlet token = tokenDiv.value;\n\t\tlet func = 'schulmanager.schulmanager_substitution_ui.ajax_onTeacherAccountLinkReset';\n\n\t\tthis.egw.json(func, [row_ids, token], function (result) {\n\t\t\tlet nm = <et2_nextmatch>et2.getWidgetById('nm');\n\t\t\t//nm.refresh(result['row_id'], et2_nextmatch.UPDATE);\n\t\t\tnm.applyFilters();\n\t\t}).sendRequest(true);\n\t}\n\n\tdelLnwPerA(){\n\t\tlet et2 = this.et2;\n\t\tlet egw = this.egw;\n\t\tlet tokenDiv = <HTMLInputElement> document.getElementById('schulmanager-schuelerview_token');\n\t\tlet token = tokenDiv.value;\n\t\tet2_dialog.show_dialog(function(button_id,value)\n\t\t{\n\t\t\tif (button_id == et2_dialog.OK_BUTTON)\n\t\t\t{\n\t\t\t\tegw.loading_prompt('schulmanager',true,egw.lang('please wait...'));\n\t\t\t\tlet func = 'schulmanager.schulmanager_ui.ajax_delLnwPerA';\n\t\t\t\tegw.json(func, [token], function (result) {\n\t\t\t\t\tlet not_nm = <et2_nextmatch>et2.getWidgetById('not_nm');\n\t\t\t\t\tnot_nm.applyFilters();\n\t\t\t\t}).sendRequest(true);\n\t\t\t\tegw.loading_prompt('schulmanager',false);\n\t\t\t}\n\n\t\t}, egw.lang('Confirmation required'), egw.lang('Confirmation required'), {}, et2_dialog.BUTTONS_OK_CANCEL, et2_dialog.QUESTION_MESSAGE);\n\t}\n\n\tdelLnwPerB(){\n\t\tlet et2 = this.et2;\n\t\tlet egw = this.egw;\n\t\tlet tokenDiv = <HTMLInputElement> document.getElementById('schulmanager-schuelerview_token');\n\t\tlet token = tokenDiv.value;\n\t\tet2_dialog.show_dialog(function(button_id,value)\n\t\t{\n\t\t\tif (button_id == et2_dialog.OK_BUTTON)\n\t\t\t{\n\t\t\t\tlet func = 'schulmanager.schulmanager_ui.ajax_delLnwPerB';\n\t\t\t\tegw.json(func, [token], function (result) {\n\t\t\t\t}).sendRequest(true);\n\t\t\t}\n\t\t\tlet not_nm = <et2_nextmatch>et2.getWidgetById('not_nm');\n\t\t\tnot_nm.applyFilters();\n\t\t}, egw.lang('Confirmation required'), egw.lang('Confirmation required'), {}, et2_dialog.BUTTONS_OK_CANCEL, et2_dialog.QUESTION_MESSAGE);\n\t\t//var modal = document.getElementById(\"schulmanager-notenmanager-notendetails_editcontentmodal\");\n\t\t//modal.style.display = \"none\";\n\t}\n\n\tresetAllGrades(){\n\t\tlet et2 = this.et2;\n\t\tlet tokenDiv = <HTMLInputElement> document.getElementById('schulmanager-mntc_token');\n\t\tlet token = tokenDiv.value;\n\n\t\tet2_dialog.show_prompt(function(button_id, value){\n\t\t\tif (button_id == et2_dialog.OK_BUTTON)\n\t\t\t{\n\t\t\t\tlet func = 'schulmanager.schulmanager_mntc_ui.ajax_resetAllGrades';\n\t\t\t\tegw.json(func, [token, value], function (result) {\n\t\t\t\t\tif(result.error_msg){\n\t\t\t\t\t\tegw(window).message(result.error_msg, 'error');\n\t\t\t\t\t}\n\t\t\t\t\tegw(window).message(result.msg, 'success');\n\t\t\t\t}).sendRequest(true);\n\t\t\t}\n\t\t}, egw.lang('Confirmation required'), egw.lang('Absolut sicher, dass alle Noten gelöscht werden sollen?'), {}, et2_dialog.BUTTONS_OK_CANCEL, et2_dialog.QUESTION_MESSAGE);\n\t}\n}\n\napp.classes.schulmanager = SchulmanagerApp;\n\n\n\n"],"names":["SchulmanagerApp","EgwApp","appname","constructor","et2_ready","et2","name","header_change","cal_header_change","cal_hide_items","onSchuelerViewKlasseChanged","func","query","egw","json","totals","key","widget","getWidgetById","set_value","sendRequest","exportpdf_nb","_id","_widget","loading_prompt","lang","$a","jQuery","document","createElement","appendTo","hide","url","window","webserverUrl","prop","click","remove","exportpdf_kv","id","params","modal","getElementById","style","display","exportpdf_nbericht_prepare","result","length","options","i","opt","value","text","add","exportpdf_nbericht","showReturn","checked","showSigned","signerWidget","signerid","exportpdf_calm","getDOMNode","childNodes","innerHTML","parentNode","classList","css","cal_focus_item","_action","_send","blur","calEditMultiple","calDeleteEvent","refresh","nm","etemplate2","getById","widgetContainer","add_list_event","prefix","type_id","concat","fach_id","user_id","type","fach","user","calShowAddEvent","action","selected","nmEditGew","changeNote","_senders","tokenDiv","inputinfo_date","inputinfo_type","inputinfo_desc","noteKey","noteVal","token","note_date","note_type","note_desc","nodeName","_widget_id","addClass","alert","cssAvgKey","removeClass","changeGew","senders","gewKey","gewVal","changeGewAllModified","cssAltBKey","widgetAltB","subs_TeacherChanged","teacher_id","firstChild","removeChild","item","SlMenuItem","innerText","appendChild","onDetailsNote","instance","stud_id","_index","updateDetailsNoten","widget_id","onContactData","tableUpdate","onDetailsKlasseChanged","klasse_id","widgetItem","onDetailsSchuelerChanged","schueler_id","id_prefix","block","sIndex","index","parseInt","col","widget_col_id","widget_col","onDetailsNotenEdit","idPostfix","substring","isGlnw","widgetNote","note_input","widgetTypeGKlnw","selTypeGlnw","selTypeKlnw","menuItems","trim","widgetDefDate","defDate_input","widgetDesc","desc_input","note_key","onDetailsNotenCommit","noteElement","typeFlagElement","typeFlag","dateElement","descElement","tokenElement","noteKeyElement","onDetailsNotenCancel","onDetailsNotenDelete","action_id","et2_dialog","show_dialog","button_id","NO_BUTTON","BUTTONS_OK_CANCEL","QUESTION_MESSAGE","not_nm","applyFilters","schuelerViewUpdate","onSchuelerViewSchuelerChanged","rows","table","deleteRow","r","newRow","insertRow","rowData","cell","insertCell","onTeacherAutoLinking","onTeacherAccountLinkEdit","row_id","onTeacherAccountLinkCommit","selAccount","account","et2_nextmatch","UPDATE","onTeacherAccountLinkReset","row_ids","push","delLnwPerA","OK_BUTTON","delLnwPerB","resetAllGrades","show_prompt","error_msg","message","msg","app","classes","schulmanager"],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAWO,MAAMA,eAAN,SAA8BC,MAA9B,CACP;AACUC,EAAAA,OAAO,GAAG,cAAH;;AAEhBC,EAAAA,WAAW,GACX;AACC,UAAM,cAAN;AACA;AAED;AACD;AACA;AACA;AACA;AACA;AACA;AACA;;;AACCC,EAAAA,SAAS,CAACC,GAAD,EAAMC,IAAN,EACT;AACC;AACA,UAAMF,SAAN,CAAgBC,GAAhB,EAAqBC,IAArB;;AAEA,QAAIA,IAAI,IAAI,iCAAZ,EAA+C;AACrC,WAAKC,aAAL;AACT;;AACD,QAAID,IAAI,IAAI,gCAAZ,EAA8C;AAEvC;;AACP,QAAIA,IAAI,IAAI,6BAAZ,EAA2C;AAC1C,WAAKE,iBAAL;AACA,WAAKC,cAAL;AACM;;AACP,QAAIH,IAAI,IAAI,wCAAZ,EAAsD;AACrD,WAAKC,aAAL;AACA;;AACD,QAAID,IAAI,IAAI,2BAAZ,EAAyC;AACxC,WAAKI,2BAAL;AACA;AACD;AAGD;AACD;AACA;AACA;;;AACCH,EAAAA,aAAa,GACb;AACC,QAAIF,GAAG,GAAG,KAAKA,GAAf;AACA,QAAIM,IAAI,GAAG,mDAAX;AACA,QAAIC,KAAK,GAAG,EAAZ;AACA,SAAKC,GAAL,CAASC,IAAT,CAAcH,IAAd,EAAoB,CAACC,KAAD,CAApB,EAA6B,UAAUG,MAAV,EAAkB;AAC9C,WAAK,IAAIC,GAAT,IAAgBD,MAAhB,EAAuB;AACtB,YAAIE,MAAM,GAAGZ,GAAG,CAACa,aAAJ,CAAkBF,GAAlB,CAAb;;AACA,YAAGC,MAAH,EAAU;AACTA,UAAAA,MAAM,CAACE,SAAP,CAAiBJ,MAAM,CAACC,GAAD,CAAvB;AACA;AACD;AACD,KAPD,EAOGI,WAPH,CAOe,IAPf;AAQA,GAzDF;;;AA4DCC,EAAAA,YAAY,CAACC,GAAD,EAAMC,OAAN,EACZ;AACC,SAAKV,GAAL,CAASW,cAAT,CAAwB,cAAxB,EAAuC,IAAvC,EAA6C,KAAKX,GAAL,CAASY,IAAT,CAAc,gBAAd,CAA7C;AACA,QAAIC,EAAE,GAAGC,MAAM,CAACC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAD,CAAN,CAAoCC,QAApC,CAA6C,MAA7C,EAAqDC,IAArD,EAAT;AACA,QAAIC,GAAG,GAAGC,MAAM,CAACpB,GAAP,CAAWqB,YAAX,GAAwB,0EAAlC;AACAR,IAAAA,EAAE,CAACS,IAAH,CAAQ,MAAR,EAAeH,GAAf;AACAN,IAAAA,EAAE,CAACS,IAAH,CAAQ,UAAR,EAAmB,EAAnB;AACAT,IAAAA,EAAE,CAAC,CAAD,CAAF,CAAMU,KAAN;AACAV,IAAAA,EAAE,CAACW,MAAH;AACA,SAAKxB,GAAL,CAASW,cAAT,CAAwB,cAAxB,EAAuC,KAAvC;AACA;AAGD;AACD;AACA;AACA;AACA;AACA;;;AACCc,EAAAA,YAAY,CAAChB,GAAD,EAAMC,OAAN,EAAc;AACzB,QAAIgB,EAAE,GAAGhB,OAAO,CAACgB,EAAjB;AACA,QAAIC,MAAM,GAAG,WAAb;;AAEA,QAAGD,EAAE,IAAI,4BAAT,EAAsC;AACrCC,MAAAA,MAAM,GAAG,iBAAT;AACA,KAFD,MAGK,IAAGD,EAAE,IAAI,4BAAT,EAAsC;AAC1CC,MAAAA,MAAM,GAAG,iBAAT;AACA;;AAED,QAAIC,KAAK,GAAGb,QAAQ,CAACc,cAAT,CAAwB,uDAAxB,CAAZ;AACAD,IAAAA,KAAK,CAACE,KAAN,CAAYC,OAAZ,GAAsB,MAAtB;AAEA,SAAK/B,GAAL,CAASW,cAAT,CAAwB,cAAxB,EAAuC,IAAvC,EAA4CX,GAAG,CAACY,IAAJ,CAAS,gBAAT,CAA5C;AAEA,QAAIC,EAAE,GAAGC,MAAM,CAACC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAD,CAAN,CAAoCC,QAApC,CAA6C,MAA7C,EAAqDC,IAArD,EAAT;AACA,QAAIC,GAAG,GAAGC,MAAM,CAACpB,GAAP,CAAWqB,YAAX,GAAwB,2EAAxB,GAAoGM,MAA9G;AACAd,IAAAA,EAAE,CAACS,IAAH,CAAQ,MAAR,EAAeH,GAAf;AACAN,IAAAA,EAAE,CAACS,IAAH,CAAQ,UAAR,EAAmB,EAAnB;AACAT,IAAAA,EAAE,CAAC,CAAD,CAAF,CAAMU,KAAN;AACAV,IAAAA,EAAE,CAACW,MAAH;AAEAxB,IAAAA,GAAG,CAACW,cAAJ,CAAmB,cAAnB,EAAkC,KAAlC;AACA;AAED;AACD;AACA;AACA;AACA;;;AACCqB,EAAAA,0BAA0B,CAACvB,GAAD,EAAMC,OAAN,EAAc;AACvC,QAAIkB,KAAK,GAAGb,QAAQ,CAACc,cAAT,CAAwB,uDAAxB,CAAZ;AACAD,IAAAA,KAAK,CAACE,KAAN,CAAYC,OAAZ,GAAsB,OAAtB;AAEA,QAAIjC,IAAI,GAAG,oDAAX;AAEA,SAAKE,GAAL,CAASC,IAAT,CAAcH,IAAd,EAAoB,EAApB,EAAwB,UAAUmC,MAAV,EAAkB;AACzC,UAAI7B,MAAM,GAAuBW,QAAQ,CAACc,cAAT,CAAwB,mDAAxB,CAAjC;;AAEA,UAAGzB,MAAH,EAAU;AACT,YAAI8B,MAAM,GAAG9B,MAAM,CAAC+B,OAAP,CAAeD,MAA5B;;AACA,aAAK,IAAIE,CAAC,GAAGF,MAAM,GAAC,CAApB,EAAuBE,CAAC,IAAI,CAA5B,EAA+BA,CAAC,EAAhC,EAAoC;AACnChC,UAAAA,MAAM,CAAC+B,OAAP,CAAeC,CAAf,IAAoB,IAApB;AACA;;AACD,aAAK,IAAIjC,GAAT,IAAgB8B,MAAM,CAAC,aAAD,CAAtB,EAAsC;AACrC,cAAII,GAAG,GAAGtB,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAV;AACAqB,UAAAA,GAAG,CAACC,KAAJ,GAAYnC,GAAZ;AACAkC,UAAAA,GAAG,CAACE,IAAJ,GAAWN,MAAM,CAAC,aAAD,CAAN,CAAsB9B,GAAtB,CAAX;AACAC,UAAAA,MAAM,CAAC+B,OAAP,CAAeK,GAAf,CAAmBH,GAAnB;AACA;AACD;AACD,KAfD,EAeG9B,WAfH,CAee,IAff;AAgBA;AAED;AACD;AACA;AACA;AACA;AACA;;;AACCkC,EAAAA,kBAAkB,CAAChC,GAAD,EAAMC,OAAN,EAAc;AAC/B,QAAIkB,KAAK,GAAGb,QAAQ,CAACc,cAAT,CAAwB,uDAAxB,CAAZ;AACAD,IAAAA,KAAK,CAACE,KAAN,CAAYC,OAAZ,GAAsB,MAAtB;AACA,SAAK/B,GAAL,CAASW,cAAT,CAAwB,cAAxB,EAAuC,IAAvC,EAA6C,KAAKX,GAAL,CAASY,IAAT,CAAc,gBAAd,CAA7C;AACA,QAAI8B,UAAU,GAAG3B,QAAQ,CAACc,cAAT,CAAwB,wDAAxB,EAAkFc,OAAnG;AACA,QAAIC,UAAU,GAAG7B,QAAQ,CAACc,cAAT,CAAwB,wDAAxB,EAAkFc,OAAnG;AACA,QAAIE,YAAY,GAAuB9B,QAAQ,CAACc,cAAT,CAAwB,mDAAxB,CAAvC;AACA,QAAIiB,QAAQ,GAAGD,YAAY,CAACP,KAA5B;AACA,QAAIzB,EAAE,GAAGC,MAAM,CAACC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAD,CAAN,CAAoCC,QAApC,CAA6C,MAA7C,EAAqDC,IAArD,EAAT;AACA,QAAIC,GAAG,GAAGC,MAAM,CAACpB,GAAP,CAAWqB,YAAX,GAAwB,gGAAxB,GAAyHqB,UAAzH,GAAoI,UAApI,GAA+IE,UAA/I,GAA0J,YAA1J,GAAuKE,QAAjL;AACAjC,IAAAA,EAAE,CAACS,IAAH,CAAQ,MAAR,EAAeH,GAAf;AACAN,IAAAA,EAAE,CAACS,IAAH,CAAQ,UAAR,EAAmB,EAAnB;AACAT,IAAAA,EAAE,CAAC,CAAD,CAAF,CAAMU,KAAN;AACAV,IAAAA,EAAE,CAACW,MAAH;AACA,SAAKxB,GAAL,CAASW,cAAT,CAAwB,cAAxB,EAAuC,KAAvC;AACA;AAED;AACD;AACA;AACA;AACA;;;AACCoC,EAAAA,cAAc,CAACtC,GAAD,EAAMC,OAAN,EACd;AACC,QAAIV,GAAG,GAAG,KAAKA,GAAf;AACMA,IAAAA,GAAG,CAACW,cAAJ,CAAmB,cAAnB,EAAkC,IAAlC,EAAuCX,GAAG,CAACY,IAAJ,CAAS,gBAAT,CAAvC;AACN,QAAIC,EAAE,GAAGC,MAAM,CAACC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAD,CAAN,CAAoCC,QAApC,CAA6C,MAA7C,EAAqDC,IAArD,EAAT;AACA,QAAIC,GAAG,GAAGC,MAAM,CAACpB,GAAP,CAAWqB,YAAX,GAAwB,4EAAlC;AACAR,IAAAA,EAAE,CAACS,IAAH,CAAQ,MAAR,EAAeH,GAAf;AACAN,IAAAA,EAAE,CAACS,IAAH,CAAQ,UAAR,EAAmB,EAAnB;AACAT,IAAAA,EAAE,CAAC,CAAD,CAAF,CAAMU,KAAN;AACAV,IAAAA,EAAE,CAACW,MAAH;AACA,SAAKxB,GAAL,CAASW,cAAT,CAAwB,cAAxB,EAAuC,KAAvC;AACA;AAGD;AACD;AACA;AACA;AACA;;;AACChB,EAAAA,iBAAiB,GACjB;AACC,QAAIH,GAAG,GAAG,KAAKA,GAAf;AACA,QAAIM,IAAI,GAAG,mDAAX;AAEA,QAAIC,KAAK,GAAG,EAAZ;AACA,SAAKC,GAAL,CAASC,IAAT,CAAcH,IAAd,EAAoB,CAACC,KAAD,CAApB,EAA6B,UAAUkC,MAAV,EAAkB;AAC9C,WAAK,IAAI9B,GAAT,IAAgB8B,MAAM,CAAC,WAAD,CAAtB,EAAoC;AACnC,YAAI7B,MAAM,GAAGZ,GAAG,CAACa,aAAJ,CAAkBF,GAAlB,CAAb;;AACA,YAAGC,MAAH,EAAU;AACTA,UAAAA,MAAM,CAAC4C,UAAP,GAAoBC,UAApB,CAA+B,CAA/B,EAAkCC,SAAlC,GAA8CjB,MAAM,CAAC,WAAD,CAAN,CAAoB9B,GAApB,EAAyB,IAAzB,CAA9C;AACAC,UAAAA,MAAM,CAAC4C,UAAP,GAAoBC,UAApB,CAA+B,CAA/B,EAAkCC,SAAlC,GAA8CjB,MAAM,CAAC,WAAD,CAAN,CAAoB9B,GAApB,EAAyB,MAAzB,CAA9C;AACAC,UAAAA,MAAM,CAAC+C,UAAP,CAAkBA,UAAlB,CAA6BC,SAA7B,CAAuC5B,MAAvC,CAA8C,aAA9C;AACApB,UAAAA,MAAM,CAAC+C,UAAP,CAAkBA,UAAlB,CAA6BC,SAA7B,CAAuC5B,MAAvC,CAA8C,aAA9C;AACApB,UAAAA,MAAM,CAAC+C,UAAP,CAAkBA,UAAlB,CAA6BC,SAA7B,CAAuCZ,GAAvC,CAA2CP,MAAM,CAAC,WAAD,CAAN,CAAoB9B,GAApB,EAAyB,OAAzB,CAA3C;;AAEA,cAAI8B,MAAM,CAAC,WAAD,CAAN,CAAoB9B,GAApB,EAAyB,OAAzB,KAAqC,aAArC,IAAsDC,MAAM,CAAC4C,UAAP,GAAoBC,UAApB,CAA+B,CAA/B,CAA1D,EAA6F;AAC1E7C,YAAAA,MAAM,CAAC4C,UAAP,GAAoBC,UAApB,CAA+B,CAA/B,EAAkCnB,KAAlC,CAAwCC,OAAxC,GAAkD,MAAlD;AACH;AAChB;AACD;AACD,KAfD,EAeGxB,WAfH,CAee,IAff;AAgBA;;AAEDX,EAAAA,cAAc,GACd;AACCI,IAAAA,GAAG,CAACqD,GAAJ,CAAQ,gBAAR,EAAyB,cAAzB;AACA;;AAEDC,EAAAA,cAAc,CAACC,OAAD,EAAUnD,MAAV,EACd;AACC;AACA,QAAIoD,KAAK,GAAG,YAAW;AACtBxD,MAAAA,GAAG,GAAGC,IAAN,CACC,oDADD,EAEC,CACCG,MAAM,CAACsB,EADR,CAFD;AAMC,gBAASO,MAAT,EAAiB;AAChBnB,QAAAA,MAAM,CAACyC,OAAD,CAAN,CAAgBE,IAAhB,GADgB;AAGhB,OATF,EAUElD,WAVF,CAUc,IAVd;AAWA,KAZD;;AAaAiD,IAAAA,KAAK;AACL;;AAEDE,EAAAA,eAAe,CAACH,OAAD,EAAUnD,MAAV,EACf;AACC;AACA,QAAIoD,KAAK,GAAG,YAAW;AACtBxD,MAAAA,GAAG,GAAGC,IAAN,CACC,oDADD,EAEC,CACCG,MAAM,CAACsB,EADR,EAEC,IAFD,CAFD;AAOC,gBAASO,MAAT,EAAiB;AAChBnB,QAAAA,MAAM,CAACyC,OAAD,CAAN,CAAgBE,IAAhB,GADgB;AAGhB,OAVF,EAWElD,WAXF,CAWc,IAXd;AAYA,KAbD;;AAcAiD,IAAAA,KAAK;AACL;;AAEDG,EAAAA,cAAc,CAACJ,OAAD,EAAUnD,MAAV,EACd;AACC;AACA,QAAIoD,KAAK,GAAG,YAAW;AACtBxD,MAAAA,GAAG,GAAGC,IAAN,CACC,mDADD,EAEC,CACCG,MAAM,CAAC,CAAD,CAAN,CAAUsB,EADX,CAFD;AAMC,gBAASO,MAAT,EAAiB;AAChBjC,QAAAA,GAAG,CAACoB,MAAD,CAAH,CAAYwC,OAAZ,CAAoB3B,MAAM,CAAC,KAAD,CAA1B,EAAmC,cAAnC,EAAmD,iCAAnD,EAAsF,QAAtF;AACA,YAAI4B,EAAE,GAAGC,UAAU,CAACC,OAAX,CAAmB,iCAAnB,EAAsDC,eAAtD,CAAsE3D,aAAtE,CAAoF,IAApF,CAAT;AACAwD,QAAAA,EAAE,CAACD,OAAH,CAAW,IAAX,EAAgB,QAAhB;AACA,OAVF,EAWErD,WAXF,CAWc,IAXd;AAYA,KAbD;;AAcAiD,IAAAA,KAAK;AACL;;AAEDS,EAAAA,cAAc,CAAC7D,MAAD,EAAQ8D,MAAR,EAAe;AAC5B,QAAI1E,GAAG,GAAG,KAAKA,GAAf;AACA,QAAI2E,OAAO,GAAGD,MAAM,CAACE,MAAP,CAAc,sBAAd,CAAd;AACA,QAAIC,OAAO,GAAGH,MAAM,CAACE,MAAP,CAAc,sBAAd,CAAd;AACA,QAAIE,OAAO,GAAGJ,MAAM,CAACE,MAAP,CAAc,cAAd,CAAd;AAEA,QAAIG,IAAI,GAAuBxD,QAAQ,CAACc,cAAT,CAAwBsC,OAAxB,CAApB,CAAsD7B,KAAjE;AACA,QAAIkC,IAAI,GAAuBzD,QAAQ,CAACc,cAAT,CAAwBwC,OAAxB,CAApB,CAAsD/B,KAAjE;AACA,QAAImC,IAAI,GAAG,IAAX;;AAEA,QAAG1D,QAAQ,CAACc,cAAT,CAAwByC,OAAxB,CAAH,EAAoC;AACnCG,MAAAA,IAAI,GAAuB1D,QAAQ,CAACc,cAAT,CAAwByC,OAAxB,CAApB,CAAsDhC,KAA7D;AACA,KAFD,MAGI;AACHgC,MAAAA,OAAO,GAAGJ,MAAM,CAACE,MAAP,CAAc,iBAAd,CAAV;AACAK,MAAAA,IAAI,GAAuB1D,QAAQ,CAACc,cAAT,CAAwByC,OAAxB,CAApB,CAAsDhC,KAA7D;AACA;;AAED,QAAIkB,KAAK,GAAG,YAAW;AACtBxD,MAAAA,GAAG,GAAGC,IAAN,CACC,sDADD,EAEC,CACCsE,IADD,EAECC,IAFD,EAGCC,IAHD,CAFD;AAQC,gBAASxC,MAAT,EAAuB;AACtBjC,QAAAA,GAAG,CAACoB,MAAD,CAAH,CAAYwC,OAAZ,CAAoB3B,MAAM,CAAC,KAAD,CAA1B,EAAmC,cAAnC,EAAmD,iCAAnD,EAAsF,QAAtF;AACA,YAAI4B,EAAE,GAAGC,UAAU,CAACC,OAAX,CAAmB,iCAAnB,EAAsDC,eAAtD,CAAsE3D,aAAtE,CAAoF,IAApF,CAAT;AACAwD,QAAAA,EAAE,CAACD,OAAH,CAAW,IAAX,EAAgB,QAAhB;AACA,OAZF,EAaErD,WAbF,CAac,IAbd;AAcA,KAfD;;AAgBAiD,IAAAA,KAAK;AAEL;;AAEDkB,EAAAA,eAAe,CAACC,MAAD,EAASC,QAAT,EAAkB;AAChC9D,IAAAA,MAAM,CAAC,mBAAD,CAAN,CAA4BuC,GAA5B,CAAgC,SAAhC,EAA0C,QAA1C;AACA;;AAEDwB,EAAAA,SAAS,CAACtB,OAAD,EAAUnD,MAAV,EACT;AACCU,IAAAA,MAAM,CAAC,eAAD,CAAN,CAAwBuC,GAAxB,CAA4B,SAA5B,EAAsC,QAAtC;AACA;AAGD;AACD;AACA;AACA;AACA;;;AACCyB,EAAAA,UAAU,CAACH,MAAD,EAASI,QAAT,EACV;AACC,QAAIC,QAAQ,GAAsBjE,QAAQ,CAACc,cAAT,CAAwB,sCAAxB,CAAlC,CADD;;AAGC,QAAIoD,cAAc,GAAsBlE,QAAQ,CAACc,cAAT,CAAwB,+CAAxB,CAAxC,CAHD;;AAIC,QAAIqD,cAAc,GAAsBnE,QAAQ,CAACc,cAAT,CAAwB,oDAAxB,CAAxC;AACA,QAAIsD,cAAc,GAAsBpE,QAAQ,CAACc,cAAT,CAAwB,+CAAxB,CAAxC;AAEA,QAAI/B,IAAI,GAAG,gDAAX;AACA,QAAIsF,OAAO,GAAGT,MAAM,CAAClF,IAArB;AACA,QAAI4F,OAAO,GAAGV,MAAM,CAACrC,KAArB;AACA,QAAIgD,KAAK,GAAGN,QAAQ,CAAC1C,KAArB;AAEA,QAAIiD,SAAS,GAAGN,cAAc,CAAC3C,KAA/B;AACA,QAAIkD,SAAS,GAAGN,cAAc,CAAC5C,KAA/B;AACA,QAAImD,SAAS,GAAGN,cAAc,CAAC7C,KAA/B;;AAEA,QAAGyC,QAAQ,CAACW,QAAT,IAAqB,cAAxB,EAAuC;AACtCN,MAAAA,OAAO,GAAGL,QAAQ,CAACY,UAAnB;;AACA,UAAGZ,QAAQ,CAACpC,OAAZ,EAAoB;AACnB0C,QAAAA,OAAO,GAAG,CAAV;AACA,OAFD,MAEK;AACJA,QAAAA,OAAO,GAAG,CAAV;AACA;AACD;;AACD,SAAKrF,GAAL,CAASC,IAAT,CAAcH,IAAd,EAAoB,CAACsF,OAAD,EAAUC,OAAV,EAAmBC,KAAnB,EAA0BC,SAA1B,EAAqCC,SAArC,EAAgDC,SAAhD,CAApB,EAAgF,UAAUxD,MAAV,EAAkB;AACjGnB,MAAAA,MAAM,CAAC6D,MAAD,CAAN,CAAeiB,QAAf,CAAwB,2BAAxB;;AACA,WAAK,IAAIzF,GAAT,IAAgB8B,MAAhB,EAAuB;AACtB,YAAG9B,GAAG,IAAI,WAAV,EAAsB;AACrB0F,UAAAA,KAAK,CAAC,eAAa5D,MAAM,CAAC9B,GAAD,CAApB,CAAL;AACA;AACA;;AAED,YAAI2F,SAAS,GAAG,oCAAkC3F,GAAlC,GAAsC,YAAtD;AACA,YAAIC,MAAM,GAAsBW,QAAQ,CAACc,cAAT,CAAwBiE,SAAxB,CAAhC;;AACA,YAAG1F,MAAH,EAAU;AACTA,UAAAA,MAAM,CAACkC,KAAP,GAAeL,MAAM,CAAC9B,GAAD,CAAN,CAAY,YAAZ,CAAf;;AACA,cAAGwE,MAAM,CAACjD,EAAP,IAAaoE,SAAhB,EAA0B;AACzB;AACAhF,YAAAA,MAAM,CAAC6D,MAAD,CAAN,CAAeoB,WAAf,CAA2B,gBAA3B;AACAjF,YAAAA,MAAM,CAAC6D,MAAD,CAAN,CAAeoB,WAAf,CAA2B,aAA3B;AACAjF,YAAAA,MAAM,CAAC6D,MAAD,CAAN,CAAeiB,QAAf,CAAwB3D,MAAM,CAAC9B,GAAD,CAAN,CAAY,UAAZ,CAAxB;AACA;AACD;AACD;AACD,KApBD,EAoBGI,WApBH,CAoBe,IApBf;AAqBA;;AAIEyF,EAAAA,SAAS,CAACrB,MAAD,EAASsB,OAAT,EACZ;AACC,QAAIzG,GAAG,GAAG,KAAKA,GAAf;AACA,QAAIM,IAAI,GAAG,+CAAX;AACA,QAAIoG,MAAM,GAAGvB,MAAM,CAAClF,IAApB;AACA,QAAI0G,MAAM,GAAGxB,MAAM,CAACrC,KAApB;AAEA,SAAKtC,GAAL,CAASC,IAAT,CAAcH,IAAd,EAAoB,CAACoG,MAAD,EAASC,MAAT,CAApB,EAAsC,UAAUlE,MAAV,EAAkB;AACvDnB,MAAAA,MAAM,CAAC6D,MAAD,CAAN,CAAeiB,QAAf,CAAwB,2BAAxB;;AACA,WAAK,IAAIzF,GAAT,IAAgB8B,MAAhB,EAAuB;AACtB,YAAI6D,SAAS,GAAG,oCAAkC3F,GAAlC,GAAsC,YAAtD;AACA,YAAIC,MAAM,GAAsBW,QAAQ,CAACc,cAAT,CAAwBiE,SAAxB,CAAhC;;AACA,YAAG1F,MAAH,EAAU;AACTA,UAAAA,MAAM,CAACkC,KAAP,GAAeL,MAAM,CAAC9B,GAAD,CAAN,CAAY,YAAZ,CAAf;AACA;AACD;AACD,KATD,EASGI,WATH,CASe,IATf;AAUA;;AAED6F,EAAAA,oBAAoB,CAAC7C,OAAD,EAAUwB,QAAV,EACpB;AAEC,QAAIvF,GAAG,GAAG,KAAKA,GAAf;AACA,QAAIM,IAAI,GAAG,kDAAX,CAHD;;AAKC,QAAIsF,OAAO,GAAGL,QAAQ,CAACY,UAAvB;AACA,QAAIN,OAAO,GAAG9B,OAAO,CAACjB,KAAtB,CAND;;AAQC,QAAGyC,QAAQ,CAACW,QAAT,IAAqB,cAAxB,EAAuC;AACtC,UAAGX,QAAQ,CAACpC,OAAZ,EAAoB;AACnB0C,QAAAA,OAAO,GAAG,CAAV;AACA,OAFD,MAEK;AACJA,QAAAA,OAAO,GAAG,CAAV;AACA;AACD;;AACD,SAAKrF,GAAL,CAASC,IAAT,CAAcH,IAAd,EAAoB,CAACsF,OAAD,EAAUC,OAAV,CAApB,EAAwC,UAAUpD,MAAV,EAAkB;AACzDnB,MAAAA,MAAM,CAACyC,OAAD,CAAN,CAAgBqC,QAAhB,CAAyB,2BAAzB;;AACA,WAAK,IAAIzF,GAAT,IAAgB8B,MAAhB,EAAuB;AACtB,YAAI6D,SAAS,GAAG,oCAAkC3F,GAAlC,GAAsC,YAAtD;AACA,YAAIkG,UAAU,GAAG,4CAA0ClG,GAA1C,GAA8C,eAA/D;AACA,YAAIC,MAAM,GAAsBW,QAAQ,CAACc,cAAT,CAAwBiE,SAAxB,CAAhC;AACA,YAAIQ,UAAU,GAAsBvF,QAAQ,CAACc,cAAT,CAAwBwE,UAAxB,CAApC;;AACA,YAAGjG,MAAH,EAAU;AACTA,UAAAA,MAAM,CAACkC,KAAP,GAAeL,MAAM,CAAC9B,GAAD,CAAN,CAAY,YAAZ,CAAf;;AACA,cAAGoD,OAAO,CAAC7B,EAAR,IAAcoE,SAAjB,EAA2B;AAC1BhF,YAAAA,MAAM,CAACyC,OAAD,CAAN,CAAgBwC,WAAhB,CAA4B,gBAA5B;AACAjF,YAAAA,MAAM,CAACyC,OAAD,CAAN,CAAgBwC,WAAhB,CAA4B,aAA5B;AACAjF,YAAAA,MAAM,CAACyC,OAAD,CAAN,CAAgBqC,QAAhB,CAAyB3D,MAAM,CAAC9B,GAAD,CAAN,CAAY,UAAZ,CAAzB;AACA;AACD,SAPD,MAQK,IAAGmG,UAAH,EAAc;AAClBA,UAAAA,UAAU,CAAC3D,OAAX,GAAqBV,MAAM,CAAC9B,GAAD,CAAN,CAAY,eAAZ,CAArB;AACA;AACD;AACD,KAnBD,EAmBGI,WAnBH,CAmBe,IAnBf;AAoBA;AAED;AACD;AACA;;;AACCgG,EAAAA,mBAAmB,CAAChD,OAAD,EAAUwB,QAAV,EACnB;AACC,QAAIvF,GAAG,GAAG,KAAKA,GAAf;AACA,QAAIM,IAAI,GAAG,qEAAX;AACA,QAAI0G,UAAU,GAAGzB,QAAQ,CAACzC,KAA1B;AAEA,SAAKtC,GAAL,CAASC,IAAT,CAAcH,IAAd,EAAoB,CAAC0G,UAAD,CAApB,EAAkC,UAAUvE,MAAV,EAAkB;AACnD,UAAI7B,MAAM,GAAeW,QAAQ,CAACc,cAAT,CAAwB,2CAAxB,CAAzB;;AAEA,UAAGzB,MAAH,EAAU;AACT,eAAOA,MAAM,CAACqG,UAAd,EAA0B;AACzBrG,UAAAA,MAAM,CAACsG,WAAP,CAAmBtG,MAAM,CAACqG,UAA1B;AACA;;AACD,aAAK,IAAItG,GAAT,IAAgB8B,MAAhB,EAAuB;AACtB,cAAI0E,IAAI,GAAG,IAAIC,UAAJ,EAAX;AACAD,UAAAA,IAAI,CAACrE,KAAL,GAAanC,GAAb;AACAwG,UAAAA,IAAI,CAACE,SAAL,GAAiB5E,MAAM,CAAC9B,GAAD,CAAvB;AACAC,UAAAA,MAAM,CAAC0G,WAAP,CAAmBH,IAAnB;AACA;AACD;AACD,KAdD,EAcGpG,WAdH,CAce,IAdf;AAeA;AAED;AACD;AACA;AACA;AACA;;;AACCwG,EAAAA,aAAa,CAACxD,OAAD,EAAUwB,QAAV,EACb;AAEC,QAAInD,KAAK,GAAGb,QAAQ,CAACc,cAAT,CAAwB,kDAAxB,CAAZ;AACAD,IAAAA,KAAK,CAACE,KAAN,CAAYC,OAAZ,GAAsB,OAAtB;AAEA,QAAIiF,QAAQ,GAAG,IAAf;AACA,QAAIC,OAAO,GAAGlC,QAAQ,CAAC,CAAD,CAAR,CAAYmC,MAA1B;AACA,QAAIpH,IAAI,GAAG,qDAAX;AAEA,SAAKE,GAAL,CAASC,IAAT,CAAcH,IAAd,EAAoB,CAACmH,OAAD,CAApB,EAA+B,UAAUhF,MAAV,EAAkB;AAChD,UAAIL,KAAK,GAAGb,QAAQ,CAACc,cAAT,CAAwB,iCAAxB,CAAZ;AACAD,MAAAA,KAAK,CAACE,KAAN,CAAYC,OAAZ,GAAsB,OAAtB;;AAEA,WAAK,IAAI5B,GAAT,IAAgB8B,MAAhB,EAAuB;AACtB;AACA,YAAG9B,GAAG,IAAI,eAAV,EAA0B;AACzB6G,UAAAA,QAAQ,CAACG,kBAAT,CAA4BhH,GAA5B,EAAiC8B,MAAjC,EAAyC,mFAAzC;AACA,SAFD,MAGK;AACJ,cAAImF,SAAS,GAAG,wEAAwEjH,GAAxF;AACA,cAAIC,MAAM,GAAqBW,QAAQ,CAACc,cAAT,CAAwBuF,SAAxB,CAA/B;;AACA,cAAIhH,MAAJ,EAAY;AACXA,YAAAA,MAAM,CAACyG,SAAP,GAAmB5E,MAAM,CAAC9B,GAAD,CAAzB;AACA;AACD;AACD;;AACDW,MAAAA,MAAM,CAAC,oEAAD,CAAN,CAA6EuC,GAA7E,CAAiF,SAAjF,EAA2F,QAA3F;AACA,KAlBD,EAkBG9C,WAlBH,CAkBe,IAlBf;AAmBA;AAED;AACD;AACA;AACA;AACA;;;AACC8G,EAAAA,aAAa,CAAC9D,OAAD,EAAUwB,QAAV,EACb;AACC,QAAInD,KAAK,GAAGb,QAAQ,CAACc,cAAT,CAAwB,kDAAxB,CAAZ;AACAD,IAAAA,KAAK,CAACE,KAAN,CAAYC,OAAZ,GAAsB,OAAtB;AAEA,QAAIiF,QAAQ,GAAG,IAAf;AACA,QAAIC,OAAO,GAAGlC,QAAQ,CAAC,CAAD,CAAR,CAAYmC,MAA1B;AACA,QAAIpH,IAAI,GAAG,qDAAX;AAEA,SAAKE,GAAL,CAASC,IAAT,CAAcH,IAAd,EAAoB,CAACmH,OAAD,CAApB,EAA+B,UAAUhF,MAAV,EAAkB;AAChD,UAAIL,KAAK,GAAGb,QAAQ,CAACc,cAAT,CAAwB,iCAAxB,CAAZ;AACAD,MAAAA,KAAK,CAACE,KAAN,CAAYC,OAAZ,GAAsB,OAAtB;AAEAiF,MAAAA,QAAQ,CAACM,WAAT,CAAqB,0CAArB,EAAiErF,MAAM,CAAC,aAAD,CAAvE;AACA+E,MAAAA,QAAQ,CAACM,WAAT,CAAqB,0CAArB,EAAiErF,MAAM,CAAC,aAAD,CAAvE;AACA,aAAOA,MAAM,CAAC,aAAD,CAAb;AACA,aAAOA,MAAM,CAAC,aAAD,CAAb;;AAEA,WAAK,IAAI9B,GAAT,IAAgB8B,MAAhB,EAAuB;AACtB,YAAImF,SAAS,GAAG,qCAAqCjH,GAArD;AACA,YAAIC,MAAM,GAAqBW,QAAQ,CAACc,cAAT,CAAwBuF,SAAxB,CAA/B;;AACA,YAAIhH,MAAJ,EAAY;AACXA,UAAAA,MAAM,CAACyG,SAAP,GAAmB5E,MAAM,CAAC9B,GAAD,CAAzB;AACA;AACD;;AACDW,MAAAA,MAAM,CAAC,uDAAD,CAAN,CAAgEuC,GAAhE,CAAoE,SAApE,EAA8E,QAA9E;AACA,KAjBD,EAiBG9C,WAjBH,CAiBe,IAjBf;AAkBA;AAKD;AACD;AACA;;;AACCgH,EAAAA,sBAAsB,CAAChE,OAAD,EAAUwB,QAAV,EACtB;AACC,QAAIiC,QAAQ,GAAG,IAAf;AACA,QAAIhH,GAAG,GAAG,KAAKA,GAAf;AACA,SAAKA,GAAL,CAASW,cAAT,CAAwB,cAAxB,EAAuC,IAAvC,EAA4CX,GAAG,CAACY,IAAJ,CAAS,gBAAT,CAA5C;AACA,QAAIpB,GAAG,GAAG,KAAKA,GAAf;AACA,QAAIM,IAAI,GAAG,wDAAX;AACA,QAAI0H,SAAS,GAAGzC,QAAQ,CAACzC,KAAzB;AAEA,SAAKtC,GAAL,CAASC,IAAT,CAAcH,IAAd,EAAoB,CAAC0H,SAAD,CAApB,EAAiC,UAAUvF,MAAV,EAAkB;AAClD;AACA,UAAI7B,MAAM,GAAeW,QAAQ,CAACc,cAAT,CAAwB,wDAAxB,CAAzB;;AAEA,UAAGzB,MAAH,EAAU;AACT,eAAOA,MAAM,CAACqG,UAAd,EAA0B;AACzBrG,UAAAA,MAAM,CAACsG,WAAP,CAAmBtG,MAAM,CAACqG,UAA1B;AACA;;AACD,aAAK,IAAItG,GAAT,IAAgB8B,MAAM,CAAC,iBAAD,CAAtB,EAA0C;AACzC,cAAI0E,IAAI,GAAG,IAAIC,UAAJ,EAAX;AACAD,UAAAA,IAAI,CAACrE,KAAL,GAAanC,GAAb;AACAwG,UAAAA,IAAI,CAACE,SAAL,GAAgB5E,MAAM,CAAC,iBAAD,CAAN,CAA0B9B,GAA1B,CAAhB;AACAC,UAAAA,MAAM,CAAC0G,WAAP,CAAmBH,IAAnB;AACA;AACD;;AACD,aAAO1E,MAAM,CAAC,iBAAD,CAAb;;AAEA,WAAK,IAAI9B,GAAT,IAAgB8B,MAAhB,EAAuB;AACtB,YAAG9B,GAAG,IAAI,eAAV,EAA0B;AACzB6G,UAAAA,QAAQ,CAACG,kBAAT,CAA4BhH,GAA5B,EAAiC8B,MAAjC,EAAyC,sDAAzC;AACA,SAFD,MAGK;AACJ,cAAIwF,UAAU,GAAG1G,QAAQ,CAACc,cAAT,CAAwB,4CAA4C1B,GAApE,CAAjB;;AACA,cAAIsH,UAAJ,EAAgB;AACfA,YAAAA,UAAU,CAACZ,SAAX,GAAuB5E,MAAM,CAAC9B,GAAD,CAA7B;AACA;AACD;AACD;;AACDH,MAAAA,GAAG,CAACW,cAAJ,CAAmB,cAAnB,EAAkC,KAAlC;AACA,KA7BD,EA6BGJ,WA7BH,CA6Be,IA7Bf;AA8BA;AAED;AACD;AACA;;;AACCmH,EAAAA,wBAAwB,CAACnE,OAAD,EAAUwB,QAAV,EACxB;AACC,QAAIiC,QAAQ,GAAG,IAAf,CADD;;AAGC,QAAIxH,GAAG,GAAG,KAAKA,GAAf;AACA,QAAIM,IAAI,GAAG,0DAAX;AACA,QAAI6H,WAAW,GAAG5C,QAAQ,CAACzC,KAA3B;AAEA,SAAKtC,GAAL,CAASC,IAAT,CAAcH,IAAd,EAAoB,CAAC6H,WAAD,CAApB,EAAmC,UAAU1F,MAAV,EAAkB;AACpD,WAAK,IAAI9B,GAAT,IAAgB8B,MAAhB,EAAuB;AACtB,YAAG9B,GAAG,IAAI,eAAV,EAA0B;AACzB6G,UAAAA,QAAQ,CAACG,kBAAT,CAA4BhH,GAA5B,EAAiC8B,MAAjC,EAAyC,sDAAzC;AACA,SAFD,MAGK;AACJ,cAAIwF,UAAU,GAAG1G,QAAQ,CAACc,cAAT,CAAwB,4CAA4C1B,GAApE,CAAjB;;AACA,cAAIsH,UAAJ,EAAgB;AACfA,YAAAA,UAAU,CAACZ,SAAX,GAAuB5E,MAAM,CAAC9B,GAAD,CAA7B;AACA,WAFD,MAEO;AAEN;AACD;AACD,OAbmD;;AAepD,KAfD,EAeGI,WAfH,CAee,IAff;AAgBA;AAED;AACD;AACA;AACA;AACA;;;AACC4G,EAAAA,kBAAkB,CAAChH,GAAD,EAAM8B,MAAN,EAAc2F,SAAd,EAClB;AACC,QAAGzH,GAAG,IAAI,eAAV,EAA0B;AACzB,WAAK,IAAI0H,KAAT,IAAkB5F,MAAM,CAAC9B,GAAD,CAAxB,EAA8B;AAC7B,aAAI,IAAI2H,MAAR,IAAkB7F,MAAM,CAAC9B,GAAD,CAAN,CAAY0H,KAAZ,CAAlB,EAAqC;AACpC,cAAIE,KAAK,GAAGC,QAAQ,CAACF,MAAD,CAApB;;AACA,cAAGC,KAAK,IAAI,CAAC,CAAV,IAAeA,KAAK,IAAI,EAA3B,EAA8B;AAC7B,iBAAI,IAAIE,GAAR,IAAehG,MAAM,CAAC9B,GAAD,CAAN,CAAY0H,KAAZ,EAAmBE,KAAnB,CAAf,EAAyC;AACxC,kBAAIG,aAAa,GAAGN,SAAS,GAAC,GAAV,GAAcC,KAAd,GAAoB,GAApB,GAAwB,GAAxB,GAA4BE,KAA5B,GAAkC,GAAlC,GAAsC,GAAtC,GAA0CE,GAA1C,GAA8C,GAAlE;AACA,kBAAIE,UAAU,GAAGpH,QAAQ,CAACc,cAAT,CAAwBqG,aAAxB,CAAjB;;AACA,kBAAGC,UAAH,EAAc;AACbA,gBAAAA,UAAU,CAACtB,SAAX,GAAuB5E,MAAM,CAAC9B,GAAD,CAAN,CAAY0H,KAAZ,EAAmBE,KAAnB,EAA0BE,GAA1B,CAAvB;AACA;AACD;AACD;AACD;AACD;AACD;AACD;AAGD;AACD;AACA;;;AACCG,EAAAA,kBAAkB,CAAC7E,OAAD,EAAUwB,QAAV,EAClB;AACC,QAAIsD,SAAS,GAAGtD,QAAQ,CAACrD,EAAT,CAAY4G,SAAZ,CAAsB,CAAtB,CAAhB;;AACA,QAAIC,MAAM,GAAGxD,QAAQ,CAACrD,EAAT,CAAY4G,SAAZ,CAAsB,CAAtB,EAAyB,CAAzB,KAA+B,MAA5C;AACA,QAAI1G,KAAK,GAAGb,QAAQ,CAACc,cAAT,CAAwB,yDAAxB,CAAZ;AACAD,IAAAA,KAAK,CAACE,KAAN,CAAYC,OAAZ,GAAsB,OAAtB;AAEA,QAAIyG,UAAU,GAAqBzH,QAAQ,CAACc,cAAT,CAAwB,yDAAyDwG,SAAzD,GAAqE,QAA7F,CAAnC;;AACA,QAAGG,UAAH,EAAe;AACd,UAAIC,UAAU,GAAqB1H,QAAQ,CAACc,cAAT,CAAwB,+EAAxB,CAAnC;AACA4G,MAAAA,UAAU,CAACnG,KAAX,GAAmBkG,UAAU,CAAC3B,SAA9B;AACA,KAVF;;;AAaC,QAAI6B,eAAe,GAAqB3H,QAAQ,CAACc,cAAT,CAAwB,yDAAyDwG,SAAzD,GAAqE,OAA7F,CAAxC;;AACA,QAAGK,eAAH,EAAmB;AAClB,UAAIC,WAAW,GAAc5H,QAAQ,CAACc,cAAT,CAAwB,oFAAxB,CAA7B;AACA,UAAI+G,WAAW,GAAc7H,QAAQ,CAACc,cAAT,CAAwB,oFAAxB,CAA7B;;AAEA,UAAG0G,MAAH,EAAW;AACV,aAAK,IAAInG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGuG,WAAW,CAACE,SAAZ,CAAsB3G,MAA1C,EAAkDE,CAAC,EAAnD,EAAuD;AACtD,cAAIuG,WAAW,CAACE,SAAZ,CAAsBzG,CAAtB,EAAyByE,SAAzB,CAAmCiC,IAAnC,MAA6CJ,eAAe,CAACpG,KAAjE,EAAwE;AACvEqG,YAAAA,WAAW,CAACrI,SAAZ,CAAsB8B,CAAtB;AACA;AACA;AACD;;AACDuG,QAAAA,WAAW,CAAC7G,KAAZ,CAAkBC,OAAlB,GAA4B,OAA5B;AACA6G,QAAAA,WAAW,CAACtI,SAAZ,CAAsB,CAAtB;AACAsI,QAAAA,WAAW,CAAC9G,KAAZ,CAAkBC,OAAlB,GAA4B,MAA5B,CATU;;AAYVjB,QAAAA,MAAM,CAAC,uCAAD,CAAN,CAAgDuC,GAAhD,CAAoD,YAApD,EAAkE,SAAlE;AACAvC,QAAAA,MAAM,CAAC,sCAAD,CAAN,CAA+CuC,GAA/C,CAAmD,YAAnD,EAAiE,SAAjE;AACAvC,QAAAA,MAAM,CAAC,uBAAD,CAAN,CAAgCuC,GAAhC,CAAoC,QAApC,EAA8C,mBAA9C,EAdU;AAgBV,OAhBD,MAiBK;AACJ,aAAK,IAAIjB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwG,WAAW,CAACC,SAAZ,CAAsB3G,MAA1C,EAAkDE,CAAC,EAAnD,EAAuD;AACtD,cAAGwG,WAAW,CAACC,SAAZ,CAAsBzG,CAAtB,EAAyByE,SAAzB,CAAmCiC,IAAnC,MAA6CJ,eAAe,CAACpG,KAAhE,EAAsE;AACrEsG,YAAAA,WAAW,CAACtI,SAAZ,CAAsB8B,CAAtB;AACA;AACA;AACD;;AAEDuG,QAAAA,WAAW,CAACrI,SAAZ,CAAsB,CAAtB;AACAqI,QAAAA,WAAW,CAAC7G,KAAZ,CAAkBC,OAAlB,GAA4B,MAA5B;AACA6G,QAAAA,WAAW,CAAC9G,KAAZ,CAAkBC,OAAlB,GAA4B,OAA5B,CAVI;;AAaJjB,QAAAA,MAAM,CAAC,uCAAD,CAAN,CAAgDuC,GAAhD,CAAoD,YAApD,EAAkE,SAAlE;AACAvC,QAAAA,MAAM,CAAC,sCAAD,CAAN,CAA+CuC,GAA/C,CAAmD,YAAnD,EAAiE,SAAjE;AACAvC,QAAAA,MAAM,CAAC,uBAAD,CAAN,CAAgCuC,GAAhC,CAAoC,QAApC,EAA8C,mBAA9C,EAfI;AAiBJ;;AACDtC,MAAAA,QAAQ,CAACc,cAAT,CAAwB,uDAAxB,EAAiFgF,SAAjF,GAA6F0B,MAAM,GAAG,MAAH,GAAY,MAA/G;AACA,KAtDF;;;AAwDC,QAAIQ,aAAa,GAAqBhI,QAAQ,CAACc,cAAT,CAAwB,yDAAyDwG,SAAzD,GAAqE,mBAA7F,CAAtC;;AACA,QAAGU,aAAH,EAAiB;AAChB,UAAIC,aAAa,GAAsBjI,QAAQ,CAACc,cAAT,CAAwB,+EAAxB,CAAvC;AACAmH,MAAAA,aAAa,CAAC1G,KAAd,GAAsByG,aAAa,CAAClC,SAApC;AACA,KA5DF;;;AA8DC,QAAIoC,UAAU,GAAqBlI,QAAQ,CAACc,cAAT,CAAwB,yDAAyDwG,SAAzD,GAAqE,eAA7F,CAAnC;;AACA,QAAGY,UAAH,EAAc;AACb,UAAIC,UAAU,GAAsBnI,QAAQ,CAACc,cAAT,CAAwB,+EAAxB,CAApC;AACAqH,MAAAA,UAAU,CAAC5G,KAAX,GAAmB2G,UAAU,CAACpC,SAA9B;AACA,KAlEF;;;AAqEC,QAAIsC,QAAQ,GAAqBpI,QAAQ,CAACc,cAAT,CAAwB,sDAAxB,CAAjC;AACAsH,IAAAA,QAAQ,CAAC7G,KAAT,GAAiB+F,SAAjB;AACA;AAED;AACD;AACA;AACA;AACA;;;AACCe,EAAAA,oBAAoB,CAAC7F,OAAD,EAAUwB,QAAV,EACpB;AACC,QAAI/E,GAAG,GAAG,KAAKA,GAAf;AACA,QAAIgH,QAAQ,GAAG,IAAf;AACA,SAAKhH,GAAL,CAASW,cAAT,CAAwB,cAAxB,EAAuC,IAAvC,EAA4CX,GAAG,CAACY,IAAJ,CAAS,gBAAT,CAA5C,EAHD;;AAKC,QAAIyI,WAAW,GAAqBtI,QAAQ,CAACc,cAAT,CAAwB,+EAAxB,CAApC;AACA,QAAIwD,OAAO,GAAGgE,WAAW,CAAC/G,KAA1B;AAEA,QAAIgH,eAAe,GAAGvI,QAAQ,CAACc,cAAT,CAAwB,uDAAxB,CAAtB;AACA,QAAI0H,QAAQ,GAAGD,eAAe,CAACzC,SAA/B;AAEA,QAAIrB,SAAS,GAAG,GAAhB;;AAEA,QAAG+D,QAAQ,IAAI,MAAf,EAAsB;AACrB,UAAIZ,WAAW,GAAc5H,QAAQ,CAACc,cAAT,CAAwB,oFAAxB,CAA7B;AACA2D,MAAAA,SAAS,GAAGmD,WAAW,CAACrG,KAAxB;AAEA,KAJD,MAKK,IAAGiH,QAAQ,IAAI,MAAf,EAAsB;AAC1B,UAAIX,WAAW,GAAc7H,QAAQ,CAACc,cAAT,CAAwB,oFAAxB,CAA7B;AACA2D,MAAAA,SAAS,GAAGoD,WAAW,CAACtG,KAAxB;AACA;;AAED,QAAIkH,WAAW,GAAazI,QAAQ,CAACc,cAAT,CAAwB,+EAAxB,CAA5B;AACA,QAAI0D,SAAS,GAAGiE,WAAW,CAAClH,KAA5B;AAEA,QAAImH,WAAW,GAAsB1I,QAAQ,CAACc,cAAT,CAAwB,+EAAxB,CAArC;AACA,QAAI4D,SAAS,GAAGgE,WAAW,CAACnH,KAA5B;AAEA,QAAIoH,YAAY,GAAsB3I,QAAQ,CAACc,cAAT,CAAwB,8CAAxB,CAAtC;AACA,QAAIyD,KAAK,GAAGoE,YAAY,CAACpH,KAAzB;AAEA,QAAIqH,cAAc,GAAsB5I,QAAQ,CAACc,cAAT,CAAwB,sDAAxB,CAAxC;AACA,QAAIuD,OAAO,GAAGuE,cAAc,CAACrH,KAA7B,CAjCD;;AAoCC,QAAIxC,IAAI,GAAG,uDAAX;AAEA,SAAKE,GAAL,CAASC,IAAT,CAAcH,IAAd,EAAoB,CAACsF,OAAD,EAAUC,OAAV,EAAmBC,KAAnB,EAA0BC,SAA1B,EAAqCC,SAArC,EAAgDC,SAAhD,EAA2D8D,QAA3D,CAApB,EAA0F,UAAUtH,MAAV,EAAkB;AAC3G;AACA,WAAK,IAAI9B,GAAT,IAAgB8B,MAAhB,EAAuB;AACtB,YAAG9B,GAAG,IAAI,eAAV,EAA0B;AACzB6G,UAAAA,QAAQ,CAACG,kBAAT,CAA4BhH,GAA5B,EAAiC8B,MAAjC,EAAyC,sDAAzC;AACA,SAFD,MAGK;AAEJ,cAAIwF,UAAU,GAAG1G,QAAQ,CAACc,cAAT,CAAwB,4CAA4C1B,GAApE,CAAjB;;AACA,cAAIsH,UAAJ,EAAgB;AACfA,YAAAA,UAAU,CAACZ,SAAX,GAAuB5E,MAAM,CAAC9B,GAAD,CAA7B;AACA,WAFD,MAEO;AAEN;AACD;AACD;;AACDH,MAAAA,GAAG,CAACW,cAAJ,CAAmB,cAAnB,EAAkC,KAAlC;AACA,KAjBD,EAiBGJ,WAjBH,CAiBe,IAjBf,EAtCD;;AA0DC,QAAIqB,KAAK,GAAGb,QAAQ,CAACc,cAAT,CAAwB,yDAAxB,CAAZ;AACAD,IAAAA,KAAK,CAACE,KAAN,CAAYC,OAAZ,GAAsB,MAAtB;AACA;;AAED6H,EAAAA,oBAAoB,CAACrG,OAAD,EAAUwB,QAAV,EACpB;AACC,QAAInD,KAAK,GAAGb,QAAQ,CAACc,cAAT,CAAwB,yDAAxB,CAAZ;AACAD,IAAAA,KAAK,CAACE,KAAN,CAAYC,OAAZ,GAAsB,MAAtB;AACA;AAED;AACD;AACA;AACA;AACA;;;AACC8H,EAAAA,oBAAoB,CAACtG,OAAD,EAAUwB,QAAV,EACpB;AACC,QAAIiC,QAAQ,GAAG,IAAf;AACA,QAAIhH,GAAG,GAAG,KAAKA,GAAf;AAEA,QAAI0J,YAAY,GAAsB3I,QAAQ,CAACc,cAAT,CAAwB,8CAAxB,CAAtC;AACA,QAAIyD,KAAK,GAAGoE,YAAY,CAACpH,KAAzB;AAEA,QAAIqH,cAAc,GAAsB5I,QAAQ,CAACc,cAAT,CAAwB,sDAAxB,CAAxC;AACA,QAAIuD,OAAO,GAAGuE,cAAc,CAACrH,KAA7B,CARD;AAUC;;AAEA,QAAIwH,SAAS,GAAGvG,OAAO,CAAC7B,EAAxB;AACAqI,IAAAA,UAAU,CAACC,WAAX,CAAuB,UAASC,SAAT,EAAmB3H,KAAnB,EACvB;AACC,UAAI2H,SAAS,IAAIF,UAAU,CAACG,SAA5B,EACA;AACC,YAAIpK,IAAI,GAAG,sDAAX;AAEAE,QAAAA,GAAG,CAACC,IAAJ,CAASH,IAAT,EAAe,CAACsF,OAAD,EAAUE,KAAV,CAAf,EAAiC,UAAUrD,MAAV,EAAkB;AAClD,eAAK,IAAI9B,GAAT,IAAgB8B,MAAhB,EAAuB;AACtB,gBAAG9B,GAAG,IAAI,eAAV,EAA0B;AACzB6G,cAAAA,QAAQ,CAACG,kBAAT,CAA4BhH,GAA5B,EAAiC8B,MAAjC,EAAyC,sDAAzC;AACA,aAFD,MAGK;AACJ,kBAAIwF,UAAU,GAAG1G,QAAQ,CAACc,cAAT,CAAwB,4CAA4C1B,GAApE,CAAjB;;AACA,kBAAIsH,UAAJ,EAAgB;AACfA,gBAAAA,UAAU,CAACZ,SAAX,GAAuB5E,MAAM,CAAC9B,GAAD,CAA7B;AACA,eAFD,MAEO;AAGP;AACD;AAED,SAfD,EAeGI,WAfH,CAee,IAff;AAgBA;AAED,KAxBD,EAwBGP,GAAG,CAACY,IAAJ,CAAS,uBAAT,CAxBH,EAwBsCZ,GAAG,CAACY,IAAJ,CAAS,uBAAT,CAxBtC,EAwByE,EAxBzE,EAwB6EmJ,UAAU,CAACI,iBAxBxF,EAwB2GJ,UAAU,CAACK,gBAxBtH;AA0BA,QAAIxI,KAAK,GAAGb,QAAQ,CAACc,cAAT,CAAwB,yDAAxB,CAAZ;AACAD,IAAAA,KAAK,CAACE,KAAN,CAAYC,OAAZ,GAAsB,MAAtB;AACA;AAED;AACD;AACA;AACA;AACA;;;AACClC,EAAAA,2BAA2B,CAAC0D,OAAD,EAAUwB,QAAV,EAC3B;AACC,QAAIiC,QAAQ,GAAG,IAAf,CADD;;AAGC,QAAIlH,IAAI,GAAG,6DAAX;AACA,QAAI0H,SAAS,GAAG,CAAhB;;AAEA,QAAGjE,OAAO,KAAK,IAAf,EAAoB;AACnBiE,MAAAA,SAAS,GAAGzC,QAAQ,CAACzC,KAArB;AACA;;AAED,SAAKtC,GAAL,CAASC,IAAT,CAAcH,IAAd,EAAoB,CAAC0H,SAAD,CAApB,EAAiC,UAAUvF,MAAV,EAAkB;AAClD;AACH;AACA;AACA;AACA;AACA;AACG,UAAIoI,MAAM,GAAkB7K,GAAG,CAACa,aAAJ,CAAkB,QAAlB,CAA5B;AACAgK,MAAAA,MAAM,CAACC,YAAP,GARkD;AAWlD;AACA;AACA;AACA;AAEA;;AACA,UAAIlK,MAAM,GAAuBW,QAAQ,CAACc,cAAT,CAAwB,2CAAxB,CAAjC;;AACA,UAAGzB,MAAH,EAAU;AACT,eAAOA,MAAM,CAACqG,UAAd,EAA0B;AACzBrG,UAAAA,MAAM,CAACsG,WAAP,CAAmBtG,MAAM,CAACqG,UAA1B;AACA;;AACD,aAAK,IAAItG,GAAT,IAAgB8B,MAAM,CAAC,iBAAD,CAAtB,EAA0C;AACzC,cAAI0E,IAAI,GAAG,IAAIC,UAAJ,EAAX;AACAD,UAAAA,IAAI,CAACrE,KAAL,GAAanC,GAAb;AACAwG,UAAAA,IAAI,CAACE,SAAL,GAAiB5E,MAAM,CAAC,iBAAD,CAAN,CAA0B9B,GAA1B,CAAjB;AACAC,UAAAA,MAAM,CAAC0G,WAAP,CAAmBH,IAAnB;AACA;AACD;;AACD,aAAO1E,MAAM,CAAC,iBAAD,CAAb;AAEA+E,MAAAA,QAAQ,CAACuD,kBAAT,CAA4BvD,QAA5B,EAAsC/E,MAAtC;AAEA;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGG;AACA,KA9CD,EA8CG1B,WA9CH,CA8Ce,IA9Cf;AA+CA;AAED;AACD;AACA;;;AACCiK,EAAAA,6BAA6B,CAACjH,OAAD,EAAUwB,QAAV,EAAoB;AAChD,QAAIiC,QAAQ,GAAG,IAAf,CADgD;AAGhD;;AAGA,QAAIxH,GAAG,GAAG,KAAKA,GAAf;AACA,QAAIM,IAAI,GAAG,+DAAX;AACA,QAAI6H,WAAW,GAAG5C,QAAQ,CAACzC,KAA3B;AAEA,SAAKtC,GAAL,CAASC,IAAT,CAAcH,IAAd,EAAoB,CAAC6H,WAAD,CAApB,EAAmC,UAAU1F,MAAV,EAAkB;AACpD;AACH;AACA;AACA;AACA;AACA;AACG,UAAIoI,MAAM,GAAkB7K,GAAG,CAACa,aAAJ,CAAkB,QAAlB,CAA5B;AACAgK,MAAAA,MAAM,CAACC,YAAP;AAEAtD,MAAAA,QAAQ,CAACuD,kBAAT,CAA4BvD,QAA5B,EAAsC/E,MAAtC,EAVoD;AAYpD,KAZD,EAYG1B,WAZH,CAYe,IAZf;AAaA;AAED;AACD;AACA;AACA;AACA;;;AACCgK,EAAAA,kBAAkB,CAACvD,QAAD,EAAW/E,MAAX,EAAkB;AACnC;AACA+E,IAAAA,QAAQ,CAACM,WAAT,CAAqB,oCAArB,EAA2DrF,MAAM,CAAC,aAAD,CAAjE;AACA+E,IAAAA,QAAQ,CAACM,WAAT,CAAqB,oCAArB,EAA2DrF,MAAM,CAAC,aAAD,CAAjE;AACA+E,IAAAA,QAAQ,CAACM,WAAT,CAAqB,oCAArB,EAA2DrF,MAAM,CAAC,aAAD,CAAjE,EAJmC;AAMnC;;AAEA,SAAK,IAAI9B,GAAT,IAAgB8B,MAAhB,EAAuB;AACtB,UAAG9B,GAAG,IAAI,aAAP,IAAwBA,GAAG,IAAI,aAA/B,IAAgDA,GAAG,IAAI,aAA1D,EAAwE;AACvE,YAAIsH,UAAU,GAAG1G,QAAQ,CAACc,cAAT,CAAwB,+BAA+B1B,GAAvD,CAAjB;;AACA,YAAIsH,UAAJ,EAAgB;AACfA,UAAAA,UAAU,CAACZ,SAAX,GAAuB5E,MAAM,CAAC9B,GAAD,CAA7B;AACA;AACD;AACD;AACD;AAED;AACD;AACA;AACA;AACA;;;AACCmH,EAAAA,WAAW,CAAC5F,EAAD,EAAK+I,IAAL,EAAU;AACpB,QAAIC,KAAK,GAAqB3J,QAAQ,CAACc,cAAT,CAAwBH,EAAxB,CAA9B,CADoB;;AAIpB,WAAMgJ,KAAK,CAACD,IAAN,CAAWvI,MAAX,GAAoB,CAA1B,EAA6B;AAC5BwI,MAAAA,KAAK,CAACC,SAAN,CAAgB,CAAhB;AACA,KANmB;;;AASpB,QAAGD,KAAH,EAAS;AACR,WAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,IAAI,CAACvI,MAAzB,EAAiC0I,CAAC,EAAlC,EAAsC;AACrC,YAAIC,MAAM,GAAGH,KAAK,CAACI,SAAN,CAAgBJ,KAAK,CAACD,IAAN,CAAWvI,MAA3B,CAAb;AACA,YAAI6I,OAAO,GAAGN,IAAI,CAACG,CAAD,CAAlB;;AACA,aAAK,IAAIxI,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2I,OAAO,CAAC7I,MAA5B,EAAoCE,CAAC,EAArC,EAAyC;AACxC,cAAI4I,IAAI,GAAGH,MAAM,CAACI,UAAP,CAAkB7I,CAAlB,CAAX;AACA4I,UAAAA,IAAI,CAAC9H,SAAL,GAAiB6H,OAAO,CAAC3I,CAAD,CAAxB;AACA;AACD;AACD;AACD;AAGD;AACD;AACA;;;AACC8I,EAAAA,oBAAoB,CAAC3H,OAAD,EAAUwB,QAAV,EAAoB;AACvC,QAAIvF,GAAG,GAAG,KAAKA,GAAf;AACA,QAAIM,IAAI,GAAG,qEAAX;AAEA,SAAKE,GAAL,CAASC,IAAT,CAAcH,IAAd,EAAoB,EAApB,EAAwB,UAAUmC,MAAV,EAAkB;AACzC,UAAI4B,EAAE,GAAkBrE,GAAG,CAACa,aAAJ,CAAkB,IAAlB,CAAxB;AACAwD,MAAAA,EAAE,CAACyG,YAAH;AACA,KAHD,EAGG/J,WAHH,CAGe,IAHf;AAKA;AAED;AACD;AACA;AACA;AACA;;;AACC4K,EAAAA,wBAAwB,CAAC5H,OAAD,EAAUwB,QAAV,EACxB;AACC,QAAIqG,MAAM,GAAGrG,QAAQ,CAAC,CAAD,CAAR,CAAYmC,MAAzB;AAEA,QAAIpH,IAAI,GAAG,yEAAX;AAEA,SAAKE,GAAL,CAASC,IAAT,CAAcH,IAAd,EAAoB,CAACsL,MAAD,CAApB,EAA8B,UAAUnJ,MAAV,EAAkB;AAC/C,UAAIL,KAAK,GAAGb,QAAQ,CAACc,cAAT,CAAwB,wCAAxB,CAAZ;AACAD,MAAAA,KAAK,CAACE,KAAN,CAAYC,OAAZ,GAAsB,OAAtB;AAEA,aAAOE,MAAM,CAAC,iBAAD,CAAb;;AAEA,WAAK,IAAI9B,GAAT,IAAgB8B,MAAhB,EAAuB;AACtB,YAAImF,SAAS,GAAG,2BAA2BjH,GAA3C;AACA,YAAIC,MAAM,GAAqBW,QAAQ,CAACc,cAAT,CAAwBuF,SAAxB,CAA/B;;AACA,YAAIhH,MAAJ,EAAY;AACXA,UAAAA,MAAM,CAACyG,SAAP,GAAmB5E,MAAM,CAAC9B,GAAD,CAAzB;AACA;AACD;AACD,KAbD,EAaGI,WAbH,CAae,IAbf;AAcA;AAED;AACD;AACA;AACA;AACA;;;AACC8K,EAAAA,0BAA0B,CAAC9H,OAAD,EAAUwB,QAAV,EAC1B;AACC,QAAInD,KAAK,GAAGb,QAAQ,CAACc,cAAT,CAAwB,wCAAxB,CAAZ;AACAD,IAAAA,KAAK,CAACE,KAAN,CAAYC,OAAZ,GAAsB,MAAtB;AAEA,QAAIvC,GAAG,GAAG,KAAKA,GAAf;AACA,QAAI8L,UAAU,GAAsBvK,QAAQ,CAACc,cAAT,CAAwB,kCAAxB,CAApC;AACA,QAAI0J,OAAO,GAAGD,UAAU,CAAChJ,KAAzB;AACA,QAAI0C,QAAQ,GAAsBjE,QAAQ,CAACc,cAAT,CAAwB,6BAAxB,CAAlC;AACA,QAAIyD,KAAK,GAAGN,QAAQ,CAAC1C,KAArB;AAEA,QAAIxC,IAAI,GAAG,2EAAX;AAEA,SAAKE,GAAL,CAASC,IAAT,CAAcH,IAAd,EAAoB,CAACyL,OAAD,EAAUjG,KAAV,CAApB,EAAsC,UAAUrD,MAAV,EAAkB;AACvD,UAAI4B,EAAE,GAAkBrE,GAAG,CAACa,aAAJ,CAAkB,IAAlB,CAAxB;AACAwD,MAAAA,EAAE,CAACD,OAAH,CAAW3B,MAAM,CAAC,WAAD,CAAjB,EAAgCuJ,aAAa,CAACC,MAA9C;AACA,KAHD,EAGGlL,WAHH,CAGe,IAHf;AAKA;AAED;AACD;AACA;AACA;AACA;;;AACCmL,EAAAA,yBAAyB,CAACnI,OAAD,EAAUwB,QAAV,EACzB;AACC,QAAIvF,GAAG,GAAG,KAAKA,GAAf;AAEA,QAAImM,OAAO,GAAG,EAAd;;AACA,SAAK,IAAIvJ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2C,QAAQ,CAAC7C,MAA7B,EAAqCE,CAAC,EAAtC,EAA0C;AACzCuJ,MAAAA,OAAO,CAACC,IAAR,CAAa7G,QAAQ,CAAC3C,CAAD,CAAR,CAAY8E,MAAzB;AACA,KANF;;;AASC,QAAIlC,QAAQ,GAAsBjE,QAAQ,CAACc,cAAT,CAAwB,6BAAxB,CAAlC;AACA,QAAIyD,KAAK,GAAGN,QAAQ,CAAC1C,KAArB;AACA,QAAIxC,IAAI,GAAG,0EAAX;AAEA,SAAKE,GAAL,CAASC,IAAT,CAAcH,IAAd,EAAoB,CAAC6L,OAAD,EAAUrG,KAAV,CAApB,EAAsC,UAAUrD,MAAV,EAAkB;AACvD,UAAI4B,EAAE,GAAkBrE,GAAG,CAACa,aAAJ,CAAkB,IAAlB,CAAxB,CADuD;;AAGvDwD,MAAAA,EAAE,CAACyG,YAAH;AACA,KAJD,EAIG/J,WAJH,CAIe,IAJf;AAKA;;AAEDsL,EAAAA,UAAU,GAAE;AACX,QAAIrM,GAAG,GAAG,KAAKA,GAAf;AACA,QAAIQ,GAAG,GAAG,KAAKA,GAAf;AACA,QAAIgF,QAAQ,GAAsBjE,QAAQ,CAACc,cAAT,CAAwB,iCAAxB,CAAlC;AACA,QAAIyD,KAAK,GAAGN,QAAQ,CAAC1C,KAArB;AACAyH,IAAAA,UAAU,CAACC,WAAX,CAAuB,UAASC,SAAT,EAAmB3H,KAAnB,EACvB;AACC,UAAI2H,SAAS,IAAIF,UAAU,CAAC+B,SAA5B,EACA;AACC9L,QAAAA,GAAG,CAACW,cAAJ,CAAmB,cAAnB,EAAkC,IAAlC,EAAuCX,GAAG,CAACY,IAAJ,CAAS,gBAAT,CAAvC;AACA,YAAId,IAAI,GAAG,8CAAX;AACAE,QAAAA,GAAG,CAACC,IAAJ,CAASH,IAAT,EAAe,CAACwF,KAAD,CAAf,EAAwB,UAAUrD,MAAV,EAAkB;AACzC,cAAIoI,MAAM,GAAkB7K,GAAG,CAACa,aAAJ,CAAkB,QAAlB,CAA5B;AACAgK,UAAAA,MAAM,CAACC,YAAP;AACA,SAHD,EAGG/J,WAHH,CAGe,IAHf;AAIAP,QAAAA,GAAG,CAACW,cAAJ,CAAmB,cAAnB,EAAkC,KAAlC;AACA;AAED,KAbD,EAaGX,GAAG,CAACY,IAAJ,CAAS,uBAAT,CAbH,EAasCZ,GAAG,CAACY,IAAJ,CAAS,uBAAT,CAbtC,EAayE,EAbzE,EAa6EmJ,UAAU,CAACI,iBAbxF,EAa2GJ,UAAU,CAACK,gBAbtH;AAcA;;AAED2B,EAAAA,UAAU,GAAE;AACX,QAAIvM,GAAG,GAAG,KAAKA,GAAf;AACA,QAAIQ,GAAG,GAAG,KAAKA,GAAf;AACA,QAAIgF,QAAQ,GAAsBjE,QAAQ,CAACc,cAAT,CAAwB,iCAAxB,CAAlC;AACA,QAAIyD,KAAK,GAAGN,QAAQ,CAAC1C,KAArB;AACAyH,IAAAA,UAAU,CAACC,WAAX,CAAuB,UAASC,SAAT,EAAmB3H,KAAnB,EACvB;AACC,UAAI2H,SAAS,IAAIF,UAAU,CAAC+B,SAA5B,EACA;AACC,YAAIhM,IAAI,GAAG,8CAAX;AACAE,QAAAA,GAAG,CAACC,IAAJ,CAASH,IAAT,EAAe,CAACwF,KAAD,CAAf,EAAwB,UAAUrD,MAAV,EAAkB,EAA1C,EACG1B,WADH,CACe,IADf;AAEA;;AACD,UAAI8J,MAAM,GAAkB7K,GAAG,CAACa,aAAJ,CAAkB,QAAlB,CAA5B;AACAgK,MAAAA,MAAM,CAACC,YAAP;AACA,KAVD,EAUGtK,GAAG,CAACY,IAAJ,CAAS,uBAAT,CAVH,EAUsCZ,GAAG,CAACY,IAAJ,CAAS,uBAAT,CAVtC,EAUyE,EAVzE,EAU6EmJ,UAAU,CAACI,iBAVxF,EAU2GJ,UAAU,CAACK,gBAVtH,EALW;AAiBX;AACA;;AAED4B,EAAAA,cAAc,GAAE;AACf,QAAIxM,GAAG,GAAG,KAAKA,GAAf;AACA,QAAIwF,QAAQ,GAAsBjE,QAAQ,CAACc,cAAT,CAAwB,yBAAxB,CAAlC;AACA,QAAIyD,KAAK,GAAGN,QAAQ,CAAC1C,KAArB;AAEAyH,IAAAA,UAAU,CAACkC,WAAX,CAAuB,UAAShC,SAAT,EAAoB3H,KAApB,EAA0B;AAChD,UAAI2H,SAAS,IAAIF,UAAU,CAAC+B,SAA5B,EACA;AACC,YAAIhM,IAAI,GAAG,uDAAX;AACAE,QAAAA,GAAG,CAACC,IAAJ,CAASH,IAAT,EAAe,CAACwF,KAAD,EAAQhD,KAAR,CAAf,EAA+B,UAAUL,MAAV,EAAkB;AAChD,cAAGA,MAAM,CAACiK,SAAV,EAAoB;AACnBlM,YAAAA,GAAG,CAACoB,MAAD,CAAH,CAAY+K,OAAZ,CAAoBlK,MAAM,CAACiK,SAA3B,EAAsC,OAAtC;AACA;;AACDlM,UAAAA,GAAG,CAACoB,MAAD,CAAH,CAAY+K,OAAZ,CAAoBlK,MAAM,CAACmK,GAA3B,EAAgC,SAAhC;AACA,SALD,EAKG7L,WALH,CAKe,IALf;AAMA;AACD,KAXD,EAWGP,GAAG,CAACY,IAAJ,CAAS,uBAAT,CAXH,EAWsCZ,GAAG,CAACY,IAAJ,CAAS,yDAAT,CAXtC,EAW2G,EAX3G,EAW+GmJ,UAAU,CAACI,iBAX1H,EAW6IJ,UAAU,CAACK,gBAXxJ;AAYA;;AAhmCF;AAmmCAiC,GAAG,CAACC,OAAJ,CAAYC,YAAZ,GAA2BpN,eAA3B;;;;"}